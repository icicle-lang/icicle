Queries will no longer be evaluated using the C evaluator.
Snapshot mode activated with a snapshot date of 2017-01-01.
Loaded dictionary with 5 inputs, 0 outputs, 70 functions.
Selected psv file as input: test/cli/repl/data.psv

  ██▓ ▄████▄   ██▓ ▄████▄   ██▓    ▓█████
 ▓██▒▒██▀ ▀█  ▓██▒▒██▀ ▀█  ▓██▒    ▓█   ▀
 ▒██▒▒▓█    ▄ ▒██▒▒▓█    ▄ ▒██░    ▒███
 ░██░▒▓▓▄ ▄██▒░██░▒▓▓▄ ▄██▒▒██░    ▒▓█  ▄
 ░██░▒ ▓███▀ ░░██░▒ ▓███▀ ░░██████▒░▒████▒
 ░▓  ░ ░▒ ▒  ░░▓  ░ ░▒ ▒  ░░ ▒░▓  ░░░ ▒░ ░
  ▒ ░  ░  ▒    ▒ ░  ░  ▒   ░ ░ ▒  ░ ░ ░  ░
  ▒ ░░         ▒ ░░          ░ ░ REPL ░
  ░  ░ ░       ░  ░ ░          ░  ░   ░  ░
     ░            ░
                  ░     :help for help

λ -- Show everything
λ The core will be simplified prior to evaluation.
The flattened simplified avalanche will be shown during evaluation.
λ λ -- A rather complicated feature to convert to Avalanche
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-25-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-25-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-28 : Error
        , conv-0-simpflat-29 : Int
        , conv-0-simpflat-30 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-28
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-29
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-28
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-28
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-25-simpflat-2 =r acc-conv-25-simpflat-2
    acc-conv-25-simpflat-2 =w Buf_push#
                                acc-conv-25-simpflat-2
                                conv-0-simpflat-28
    acc-conv-25-simpflat-3 =r acc-conv-25-simpflat-3
    acc-conv-25-simpflat-3 =w Buf_push#
                                acc-conv-25-simpflat-3
                                conv-0-simpflat-29
}

conv-25-simpflat-16 =r acc-conv-25-simpflat-2
conv-25-simpflat-17 =r acc-conv-25-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int
flat-10-simpflat-22 =i unsafe_Array_create#
                         0 : Array Error
flat-10-simpflat-23 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
    flat-10-simpflat-22 =w Buf_read#
                             conv-25-simpflat-16
    flat-10-simpflat-23 =w Buf_read#
                             conv-25-simpflat-17
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
    flat-10-simpflat-22 =w unsafe_Array_create#
                             0
    flat-10-simpflat-23 =w unsafe_Array_create#
                             0
}

flat-10-simpflat-24 =r flat-10-simpflat-20
flat-10-simpflat-25 =r flat-10-simpflat-21
flat-10-simpflat-26 =r flat-10-simpflat-22
flat-10-simpflat-27 =r flat-10-simpflat-23

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-10-simpflat-24 : Error
  , flat-10-simpflat-25 : Int
  , flat-10-simpflat-26 : Array Error
  , flat-10-simpflat-27 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-25-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-25-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-28 : Error
        , conv-0-simpflat-29 : Int
        , conv-0-simpflat-30 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-28
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-29
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-28
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-28
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-25-simpflat-2 =r acc-conv-25-simpflat-2
    acc-conv-25-simpflat-2 =w Buf_push#
                                acc-conv-25-simpflat-2
                                conv-0-simpflat-28
    acc-conv-25-simpflat-3 =r acc-conv-25-simpflat-3
    acc-conv-25-simpflat-3 =w Buf_push#
                                acc-conv-25-simpflat-3
                                conv-0-simpflat-29
}

conv-25-simpflat-16 =r acc-conv-25-simpflat-2
conv-25-simpflat-17 =r acc-conv-25-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int
flat-10-simpflat-22 =i unsafe_Array_create#
                         0 : Array Error
flat-10-simpflat-23 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
    flat-10-simpflat-22 =w Buf_read#
                             conv-25-simpflat-16
    flat-10-simpflat-23 =w Buf_read#
                             conv-25-simpflat-17
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
    flat-10-simpflat-22 =w unsafe_Array_create#
                             0
    flat-10-simpflat-23 =w unsafe_Array_create#
                             0
}

flat-10-simpflat-24 =r flat-10-simpflat-20
flat-10-simpflat-25 =r flat-10-simpflat-21
flat-10-simpflat-26 =r flat-10-simpflat-22
flat-10-simpflat-27 =r flat-10-simpflat-23

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-10-simpflat-24 : Error
  , flat-10-simpflat-25 : Int
  , flat-10-simpflat-26 : Array Error
  , flat-10-simpflat-27 : Array Int

Core evaluation
---------------

homer|(5, [ 300 , 400 , 500 ])
marge|(1, [ 0 , 10 , 20 ])

λ λ -- Something involves the abstract buffer type
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-36-simpflat-32 =i ExceptNotAnError : Error
acc-conv-36-simpflat-33 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-36-simpflat-34 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-36-simpflat-35 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-135 : Error
        , conv-0-simpflat-136 : Int
        , conv-0-simpflat-137 : Time {
    conv-36-aval-0-simpflat-37 =r acc-conv-36-simpflat-32
    conv-36-aval-0-simpflat-38 =r acc-conv-36-simpflat-33
    conv-36-aval-0-simpflat-39 =r acc-conv-36-simpflat-34
    conv-36-aval-0-simpflat-40 =r acc-conv-36-simpflat-35
    flat-0-simpflat-42 =i ExceptNotAnError : Error
    flat-0-simpflat-43 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-44 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-45 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-36-aval-0-simpflat-37
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-36-aval-0-simpflat-38 : Array Time
        map_insert_acc_vals-flat-4-simpflat-47 =i conv-36-aval-0-simpflat-39 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-48 =i conv-36-aval-0-simpflat-40 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_loc_vals-flat-8-simpflat-50 =r map_insert_acc_vals-flat-4-simpflat-47
        map_insert_loc_vals-flat-8-simpflat-51 =r map_insert_acc_vals-flat-4-simpflat-48
        map_insert_size-flat-12 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-20 =i False : Bool
        bs_acc_mid-flat-17 =i -1 : Int
        bs_acc_ins-flat-19 =i -1 : Int
        bs_acc_low-flat-25 =i 0 : Int
        bs_acc_high-flat-26 =i sub#
                                 map_insert_size-flat-12
                                 1 : Int
        bs_acc_end-flat-27 =i False : Bool
        
        while (bs_acc_end-flat-27 == False)
        {
            bs_loc_low-flat-23 =r bs_acc_low-flat-25
            bs_loc_high-flat-24 =r bs_acc_high-flat-26
            
            if (gt#
                  bs_loc_low-flat-23
                  bs_loc_high-flat-24)
            {
                bs_acc_end-flat-27 =w True
                bs_acc_ins-flat-19 =w bs_loc_low-flat-23
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-23
                               bs_loc_high-flat-24
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-17 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-21 =r bs_acc_mid-flat-17
                bs_loc_x-flat-22 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-21
                
                if (eq#
                      bs_loc_x-flat-22
                      conv-0-simpflat-137)
                {
                    bs_acc_end-flat-27 =w True
                    bs_acc_found-flat-20 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-22
                          conv-0-simpflat-137)
                    {
                        bs_acc_low-flat-25 =w add#
                                                bs_loc_mid-flat-21
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-26 =w sub#
                                                 bs_loc_mid-flat-21
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-15 =r bs_acc_found-flat-20
        bs_loc_mid-flat-16 =r bs_acc_mid-flat-17
        bs_loc_ins-flat-18 =r bs_acc_ins-flat-19
        
        if (eq#
              bs_loc_found-flat-15
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-16
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-18
        }
        
        flat-102 =r map_insert_acc_bs_found-flat-6
        flat-103 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-102 True)
        {
            simpflat-251 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-50
                             flat-103
            simpflat-253 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-51
                             flat-103
            simpflat-258 = Buf_push#
                             simpflat-251
                             conv-0-simpflat-135
            simpflat-261 = Buf_push#
                             simpflat-253
                             conv-0-simpflat-136
            map_insert_acc_vals-flat-4-simpflat-47 =r map_insert_acc_vals-flat-4-simpflat-47
            map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-47
                                                        flat-103
                                                        simpflat-258
            map_insert_acc_vals-flat-4-simpflat-48 =r map_insert_acc_vals-flat-4-simpflat-48
            map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-48
                                                        flat-103
                                                        simpflat-261
        }
        else
        {
            copy_array-flat-31 =r map_insert_acc_keys-flat-3
            simpflat-4 = Array_length#
                           copy_array-flat-31
            
            if (eq# simpflat-4 0)
            {
                
            }
            else
            {
                simpflat-5 = unsafe_Array_index#
                               copy_array-flat-31
                               0
                map_insert_acc_keys-flat-3 =w Array_put_immutable#
                                                copy_array-flat-31
                                                0
                                                simpflat-5
            }
            
            copy_array-flat-32-simpflat-56 =r map_insert_acc_vals-flat-4-simpflat-47
            copy_array-flat-32-simpflat-57 =r map_insert_acc_vals-flat-4-simpflat-48
            simpflat-6 = Array_length#
                           copy_array-flat-32-simpflat-56
            
            if (eq# simpflat-6 0)
            {
                
            }
            else
            {
                simpflat-273 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-56
                                 0
                simpflat-275 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-57
                                 0
                map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-56
                                                            0
                                                            simpflat-273
                map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-57
                                                            0
                                                            simpflat-275
            }
            
            
            foreach (for_counter-flat-33 in map_insert_size-flat-12 .. flat-103)
            {
                update_acc-flat-34 =r map_insert_acc_keys-flat-3
                simpflat-8 = sub#
                               for_counter-flat-33
                               1
                simpflat-9 = unsafe_Array_index#
                               map_insert_loc_keys-flat-7
                               simpflat-8
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-34
                                                for_counter-flat-33
                                                simpflat-9
                update_acc-flat-35-simpflat-59 =r map_insert_acc_vals-flat-4-simpflat-47
                update_acc-flat-35-simpflat-60 =r map_insert_acc_vals-flat-4-simpflat-48
                simpflat-285 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-50
                                 simpflat-8
                simpflat-287 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-51
                                 simpflat-8
                map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-59
                                                            for_counter-flat-33
                                                            simpflat-285
                map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-60
                                                            for_counter-flat-33
                                                            simpflat-287
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-103
                                            conv-0-simpflat-137
            simpflat-363 = Buf_make# ()
            simpflat-297 = Buf_push#
                             simpflat-363
                             conv-0-simpflat-135
            simpflat-364 = Buf_make# ()
            simpflat-299 = Buf_push#
                             simpflat-364
                             conv-0-simpflat-136
            map_insert_acc_vals-flat-4-simpflat-47 =r map_insert_acc_vals-flat-4-simpflat-47
            map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-47
                                                        flat-103
                                                        simpflat-297
            map_insert_acc_vals-flat-4-simpflat-48 =r map_insert_acc_vals-flat-4-simpflat-48
            map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-48
                                                        flat-103
                                                        simpflat-299
        }
        
        flat-104 =r map_insert_acc_keys-flat-3
        flat-105-simpflat-65 =r map_insert_acc_vals-flat-4-simpflat-47
        flat-105-simpflat-66 =r map_insert_acc_vals-flat-4-simpflat-48
        flat-39-simpflat-68 =i ExceptNotAnError : Error
        flat-39-simpflat-69 =i unsafe_Array_create#
                                 0 : Array Time
        flat-39-simpflat-70 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-39-simpflat-71 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-13 = Array_length#
                        flat-104
        
        if (lt# simpflat-13 conv-3)
        {
            flat-39-simpflat-68 =w ExceptNotAnError
            flat-39-simpflat-69 =w flat-104
            flat-39-simpflat-70 =w flat-105-simpflat-65
            flat-39-simpflat-71 =w flat-105-simpflat-66
        }
        else
        {
            flat-39-simpflat-68 =w ExceptCannotCompute
            flat-39-simpflat-69 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-70 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-71 =w unsafe_Array_create#
                                     0
        }
        
        flat-39-simpflat-73 =r flat-39-simpflat-68
        flat-39-simpflat-74 =r flat-39-simpflat-69
        flat-39-simpflat-75 =r flat-39-simpflat-70
        flat-39-simpflat-76 =r flat-39-simpflat-71
        flat-0-simpflat-42 =w flat-39-simpflat-73
        flat-0-simpflat-43 =w flat-39-simpflat-74
        flat-0-simpflat-44 =w flat-39-simpflat-75
        flat-0-simpflat-45 =w flat-39-simpflat-76
    }
    else
    {
        flat-0-simpflat-42 =w conv-36-aval-0-simpflat-37
        flat-0-simpflat-43 =w unsafe_Array_create#
                                0
        flat-0-simpflat-44 =w unsafe_Array_create#
                                0
        flat-0-simpflat-45 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-78 =r flat-0-simpflat-42
    flat-0-simpflat-79 =r flat-0-simpflat-43
    flat-0-simpflat-80 =r flat-0-simpflat-44
    flat-0-simpflat-81 =r flat-0-simpflat-45
    acc-conv-36-simpflat-32 =w flat-0-simpflat-78
    acc-conv-36-simpflat-33 =w flat-0-simpflat-79
    acc-conv-36-simpflat-34 =w flat-0-simpflat-80
    acc-conv-36-simpflat-35 =w flat-0-simpflat-81
}

conv-36-simpflat-83 =r acc-conv-36-simpflat-32
conv-36-simpflat-84 =r acc-conv-36-simpflat-33
conv-36-simpflat-85 =r acc-conv-36-simpflat-34
conv-36-simpflat-86 =r acc-conv-36-simpflat-35
flat-40-simpflat-88 =i ExceptNotAnError : Error
flat-40-simpflat-89 =i unsafe_Array_create#
                         0 : Array Time
flat-40-simpflat-90 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-36-simpflat-83
      ExceptNotAnError)
{
    flat-48-simpflat-91 =i ExceptNotAnError : Error
    flat-48-simpflat-92 =i unsafe_Array_create#
                             0 : Array Time
    flat-48-simpflat-93 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-49 in 0 .. Array_length#
                                           conv-36-simpflat-84)
    {
        flat-48-simpflat-94 =r flat-48-simpflat-91
        flat-48-simpflat-95 =r flat-48-simpflat-92
        flat-48-simpflat-96 =r flat-48-simpflat-93
        simpflat-321 = unsafe_Array_index#
                         conv-36-simpflat-84
                         for_counter-flat-49
        simpflat-323 = unsafe_Array_index#
                         conv-36-simpflat-85
                         for_counter-flat-49
        simpflat-325 = unsafe_Array_index#
                         conv-36-simpflat-86
                         for_counter-flat-49
        flat-51-simpflat-97 =i ExceptNotAnError : Error
        flat-51-simpflat-98 =i unsafe_Array_create#
                                 0 : Array Time
        flat-51-simpflat-99 =i unsafe_Array_create#
                                 0 : Array Int
        
        if (eq#
              flat-48-simpflat-94
              ExceptNotAnError)
        {
            simpflat-337 = Buf_read#
                             simpflat-323
            simpflat-339 = Buf_read#
                             simpflat-325
            flat-55-simpflat-100 =i ExceptNotAnError : Error
            flat-55-simpflat-101 =i 0 : Int
            
            foreach (for_counter-flat-94 in 0 .. Array_length#
                                                   simpflat-337)
            {
                flat-55-simpflat-102 =r flat-55-simpflat-100
                flat-55-simpflat-103 =r flat-55-simpflat-101
                simpflat-344 = unsafe_Array_index#
                                 simpflat-337
                                 for_counter-flat-94
                simpflat-346 = unsafe_Array_index#
                                 simpflat-339
                                 for_counter-flat-94
                flat-96-simpflat-104 =i ExceptNotAnError : Error
                flat-96-simpflat-105 =i 0 : Int
                
                if (eq#
                      simpflat-344
                      ExceptNotAnError)
                {
                    flat-99-simpflat-106 =i ExceptNotAnError : Error
                    flat-99-simpflat-107 =i 0 : Int
                    
                    if (eq#
                          flat-55-simpflat-102
                          ExceptNotAnError)
                    {
                        simpflat-16 = add#
                                        simpflat-346
                                        flat-55-simpflat-103
                        flat-99-simpflat-106 =w ExceptNotAnError
                        flat-99-simpflat-107 =w simpflat-16
                    }
                    else
                    {
                        flat-99-simpflat-106 =w flat-55-simpflat-102
                        flat-99-simpflat-107 =w 0
                    }
                    
                    flat-99-simpflat-108 =r flat-99-simpflat-106
                    flat-99-simpflat-109 =r flat-99-simpflat-107
                    flat-96-simpflat-104 =w flat-99-simpflat-108
                    flat-96-simpflat-105 =w flat-99-simpflat-109
                }
                else
                {
                    flat-96-simpflat-104 =w simpflat-344
                    flat-96-simpflat-105 =w 0
                }
                
                flat-96-simpflat-110 =r flat-96-simpflat-104
                flat-96-simpflat-111 =r flat-96-simpflat-105
                flat-55-simpflat-100 =w flat-96-simpflat-110
                flat-55-simpflat-101 =w flat-96-simpflat-111
            }
            
            flat-107-simpflat-112 =r flat-55-simpflat-100
            flat-107-simpflat-113 =r flat-55-simpflat-101
            flat-56-simpflat-114 =i ExceptNotAnError : Error
            flat-56-simpflat-115 =i unsafe_Array_create#
                                      0 : Array Time
            flat-56-simpflat-116 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-107-simpflat-112
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-59 =i flat-48-simpflat-95 : Array Time
                map_insert_acc_vals-flat-60 =i flat-48-simpflat-96 : Array Int
                map_insert_acc_bs_found-flat-62 =i False : Bool
                map_insert_acc_bs_index-flat-61 =i -1 : Int
                map_insert_loc_keys-flat-63 =r map_insert_acc_keys-flat-59
                map_insert_loc_vals-flat-64 =r map_insert_acc_vals-flat-60
                map_insert_size-flat-68 = Array_length#
                                            map_insert_loc_keys-flat-63
                bs_acc_found-flat-76 =i False : Bool
                bs_acc_mid-flat-73 =i -1 : Int
                bs_acc_ins-flat-75 =i -1 : Int
                bs_acc_low-flat-81 =i 0 : Int
                bs_acc_high-flat-82 =i sub#
                                         map_insert_size-flat-68
                                         1 : Int
                bs_acc_end-flat-83 =i False : Bool
                
                while (bs_acc_end-flat-83 == False)
                {
                    bs_loc_low-flat-79 =r bs_acc_low-flat-81
                    bs_loc_high-flat-80 =r bs_acc_high-flat-82
                    
                    if (gt#
                          bs_loc_low-flat-79
                          bs_loc_high-flat-80)
                    {
                        bs_acc_end-flat-83 =w True
                        bs_acc_ins-flat-75 =w bs_loc_low-flat-79
                    }
                    else
                    {
                        simpflat-19 = add#
                                        bs_loc_low-flat-79
                                        bs_loc_high-flat-80
                        simpflat-20 = doubleOfInt#
                                        simpflat-19
                        simpflat-21 = div#
                                        simpflat-20
                                        2.0
                        bs_acc_mid-flat-73 =w floor#
                                                simpflat-21
                        bs_loc_mid-flat-77 =r bs_acc_mid-flat-73
                        bs_loc_x-flat-78 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-63
                                             bs_loc_mid-flat-77
                        
                        if (eq#
                              bs_loc_x-flat-78
                              simpflat-321)
                        {
                            bs_acc_end-flat-83 =w True
                            bs_acc_found-flat-76 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-78
                                  simpflat-321)
                            {
                                bs_acc_low-flat-81 =w add#
                                                        bs_loc_mid-flat-77
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-82 =w sub#
                                                         bs_loc_mid-flat-77
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-71 =r bs_acc_found-flat-76
                bs_loc_mid-flat-72 =r bs_acc_mid-flat-73
                bs_loc_ins-flat-74 =r bs_acc_ins-flat-75
                
                if (eq#
                      bs_loc_found-flat-71
                      True)
                {
                    map_insert_acc_bs_found-flat-62 =w True
                    map_insert_acc_bs_index-flat-61 =w bs_loc_mid-flat-72
                }
                else
                {
                    map_insert_acc_bs_found-flat-62 =w False
                    map_insert_acc_bs_index-flat-61 =w bs_loc_ins-flat-74
                }
                
                flat-108 =r map_insert_acc_bs_found-flat-62
                flat-109 =r map_insert_acc_bs_index-flat-61
                
                if (eq# flat-108 True)
                {
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-113
                }
                else
                {
                    copy_array-flat-86 =r map_insert_acc_keys-flat-59
                    simpflat-22 = Array_length#
                                    copy_array-flat-86
                    
                    if (eq# simpflat-22 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-23 = unsafe_Array_index#
                                        copy_array-flat-86
                                        0
                        map_insert_acc_keys-flat-59 =w Array_put_immutable#
                                                         copy_array-flat-86
                                                         0
                                                         simpflat-23
                    }
                    
                    copy_array-flat-87 =r map_insert_acc_vals-flat-60
                    simpflat-24 = Array_length#
                                    copy_array-flat-87
                    
                    if (eq# simpflat-24 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-25 = unsafe_Array_index#
                                        copy_array-flat-87
                                        0
                        map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                         copy_array-flat-87
                                                         0
                                                         simpflat-25
                    }
                    
                    
                    foreach (for_counter-flat-88 in map_insert_size-flat-68 .. flat-109)
                    {
                        update_acc-flat-89 =r map_insert_acc_keys-flat-59
                        simpflat-26 = sub#
                                        for_counter-flat-88
                                        1
                        simpflat-27 = unsafe_Array_index#
                                        map_insert_loc_keys-flat-63
                                        simpflat-26
                        map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                         update_acc-flat-89
                                                         for_counter-flat-88
                                                         simpflat-27
                        update_acc-flat-90 =r map_insert_acc_vals-flat-60
                        simpflat-29 = unsafe_Array_index#
                                        map_insert_loc_vals-flat-64
                                        simpflat-26
                        map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                         update_acc-flat-90
                                                         for_counter-flat-88
                                                         simpflat-29
                    }
                    
                    map_insert_acc_keys-flat-59 =r map_insert_acc_keys-flat-59
                    map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-59
                                                     flat-109
                                                     simpflat-321
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-113
                }
                
                flat-110 =r map_insert_acc_keys-flat-59
                flat-111 =r map_insert_acc_vals-flat-60
                flat-93-simpflat-117 =i ExceptNotAnError : Error
                flat-93-simpflat-118 =i unsafe_Array_create#
                                          0 : Array Time
                flat-93-simpflat-119 =i unsafe_Array_create#
                                          0 : Array Int
                simpflat-31 = Array_length#
                                flat-110
                
                if (lt# simpflat-31 conv-3)
                {
                    flat-93-simpflat-117 =w ExceptNotAnError
                    flat-93-simpflat-118 =w flat-110
                    flat-93-simpflat-119 =w flat-111
                }
                else
                {
                    flat-93-simpflat-117 =w ExceptCannotCompute
                    flat-93-simpflat-118 =w unsafe_Array_create#
                                              0
                    flat-93-simpflat-119 =w unsafe_Array_create#
                                              0
                }
                
                flat-93-simpflat-120 =r flat-93-simpflat-117
                flat-93-simpflat-121 =r flat-93-simpflat-118
                flat-93-simpflat-122 =r flat-93-simpflat-119
                flat-56-simpflat-114 =w flat-93-simpflat-120
                flat-56-simpflat-115 =w flat-93-simpflat-121
                flat-56-simpflat-116 =w flat-93-simpflat-122
            }
            else
            {
                flat-56-simpflat-114 =w flat-107-simpflat-112
                flat-56-simpflat-115 =w unsafe_Array_create#
                                          0
                flat-56-simpflat-116 =w unsafe_Array_create#
                                          0
            }
            
            flat-56-simpflat-123 =r flat-56-simpflat-114
            flat-56-simpflat-124 =r flat-56-simpflat-115
            flat-56-simpflat-125 =r flat-56-simpflat-116
            flat-51-simpflat-97 =w flat-56-simpflat-123
            flat-51-simpflat-98 =w flat-56-simpflat-124
            flat-51-simpflat-99 =w flat-56-simpflat-125
        }
        else
        {
            flat-51-simpflat-97 =w flat-48-simpflat-94
            flat-51-simpflat-98 =w unsafe_Array_create#
                                     0
            flat-51-simpflat-99 =w unsafe_Array_create#
                                     0
        }
        
        flat-51-simpflat-126 =r flat-51-simpflat-97
        flat-51-simpflat-127 =r flat-51-simpflat-98
        flat-51-simpflat-128 =r flat-51-simpflat-99
        flat-48-simpflat-91 =w flat-51-simpflat-126
        flat-48-simpflat-92 =w flat-51-simpflat-127
        flat-48-simpflat-93 =w flat-51-simpflat-128
    }
    
    flat-112-simpflat-129 =r flat-48-simpflat-91
    flat-112-simpflat-130 =r flat-48-simpflat-92
    flat-112-simpflat-131 =r flat-48-simpflat-93
    flat-40-simpflat-88 =w flat-112-simpflat-129
    flat-40-simpflat-89 =w flat-112-simpflat-130
    flat-40-simpflat-90 =w flat-112-simpflat-131
}
else
{
    flat-40-simpflat-88 =w conv-36-simpflat-83
    flat-40-simpflat-89 =w unsafe_Array_create#
                             0
    flat-40-simpflat-90 =w unsafe_Array_create#
                             0
}

flat-40-simpflat-132 =r flat-40-simpflat-88
flat-40-simpflat-133 =r flat-40-simpflat-89
flat-40-simpflat-134 =r flat-40-simpflat-90

output repl:output : Sum Error (Map Time Int) =
    flat-40-simpflat-132 : Error
  , flat-40-simpflat-133 : Array Time
  , flat-40-simpflat-134 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-36-simpflat-32 =i ExceptNotAnError : Error
acc-conv-36-simpflat-33 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-36-simpflat-34 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-36-simpflat-35 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-135 : Error
        , conv-0-simpflat-136 : Int
        , conv-0-simpflat-137 : Time {
    conv-36-aval-0-simpflat-37 =r acc-conv-36-simpflat-32
    conv-36-aval-0-simpflat-38 =r acc-conv-36-simpflat-33
    conv-36-aval-0-simpflat-39 =r acc-conv-36-simpflat-34
    conv-36-aval-0-simpflat-40 =r acc-conv-36-simpflat-35
    flat-0-simpflat-42 =i ExceptNotAnError : Error
    flat-0-simpflat-43 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-44 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-45 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-36-aval-0-simpflat-37
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-36-aval-0-simpflat-38 : Array Time
        map_insert_acc_vals-flat-4-simpflat-47 =i conv-36-aval-0-simpflat-39 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-48 =i conv-36-aval-0-simpflat-40 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_loc_vals-flat-8-simpflat-50 =r map_insert_acc_vals-flat-4-simpflat-47
        map_insert_loc_vals-flat-8-simpflat-51 =r map_insert_acc_vals-flat-4-simpflat-48
        map_insert_size-flat-12 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-20 =i False : Bool
        bs_acc_mid-flat-17 =i -1 : Int
        bs_acc_ins-flat-19 =i -1 : Int
        bs_acc_low-flat-25 =i 0 : Int
        bs_acc_high-flat-26 =i sub#
                                 map_insert_size-flat-12
                                 1 : Int
        bs_acc_end-flat-27 =i False : Bool
        
        while (bs_acc_end-flat-27 == False)
        {
            bs_loc_low-flat-23 =r bs_acc_low-flat-25
            bs_loc_high-flat-24 =r bs_acc_high-flat-26
            
            if (gt#
                  bs_loc_low-flat-23
                  bs_loc_high-flat-24)
            {
                bs_acc_end-flat-27 =w True
                bs_acc_ins-flat-19 =w bs_loc_low-flat-23
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-23
                               bs_loc_high-flat-24
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-17 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-21 =r bs_acc_mid-flat-17
                bs_loc_x-flat-22 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-21
                
                if (eq#
                      bs_loc_x-flat-22
                      conv-0-simpflat-137)
                {
                    bs_acc_end-flat-27 =w True
                    bs_acc_found-flat-20 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-22
                          conv-0-simpflat-137)
                    {
                        bs_acc_low-flat-25 =w add#
                                                bs_loc_mid-flat-21
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-26 =w sub#
                                                 bs_loc_mid-flat-21
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-15 =r bs_acc_found-flat-20
        bs_loc_mid-flat-16 =r bs_acc_mid-flat-17
        bs_loc_ins-flat-18 =r bs_acc_ins-flat-19
        
        if (eq#
              bs_loc_found-flat-15
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-16
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-18
        }
        
        flat-102 =r map_insert_acc_bs_found-flat-6
        flat-103 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-102 True)
        {
            simpflat-251 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-50
                             flat-103
            simpflat-253 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-51
                             flat-103
            simpflat-258 = Buf_push#
                             simpflat-251
                             conv-0-simpflat-135
            simpflat-261 = Buf_push#
                             simpflat-253
                             conv-0-simpflat-136
            map_insert_acc_vals-flat-4-simpflat-47 =r map_insert_acc_vals-flat-4-simpflat-47
            map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-47
                                                        flat-103
                                                        simpflat-258
            map_insert_acc_vals-flat-4-simpflat-48 =r map_insert_acc_vals-flat-4-simpflat-48
            map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-48
                                                        flat-103
                                                        simpflat-261
        }
        else
        {
            copy_array-flat-31 =r map_insert_acc_keys-flat-3
            simpflat-4 = Array_length#
                           copy_array-flat-31
            
            if (eq# simpflat-4 0)
            {
                
            }
            else
            {
                simpflat-5 = unsafe_Array_index#
                               copy_array-flat-31
                               0
                map_insert_acc_keys-flat-3 =w Array_put_immutable#
                                                copy_array-flat-31
                                                0
                                                simpflat-5
            }
            
            copy_array-flat-32-simpflat-56 =r map_insert_acc_vals-flat-4-simpflat-47
            copy_array-flat-32-simpflat-57 =r map_insert_acc_vals-flat-4-simpflat-48
            simpflat-6 = Array_length#
                           copy_array-flat-32-simpflat-56
            
            if (eq# simpflat-6 0)
            {
                
            }
            else
            {
                simpflat-273 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-56
                                 0
                simpflat-275 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-57
                                 0
                map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-56
                                                            0
                                                            simpflat-273
                map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-57
                                                            0
                                                            simpflat-275
            }
            
            
            foreach (for_counter-flat-33 in map_insert_size-flat-12 .. flat-103)
            {
                update_acc-flat-34 =r map_insert_acc_keys-flat-3
                simpflat-8 = sub#
                               for_counter-flat-33
                               1
                simpflat-9 = unsafe_Array_index#
                               map_insert_loc_keys-flat-7
                               simpflat-8
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-34
                                                for_counter-flat-33
                                                simpflat-9
                update_acc-flat-35-simpflat-59 =r map_insert_acc_vals-flat-4-simpflat-47
                update_acc-flat-35-simpflat-60 =r map_insert_acc_vals-flat-4-simpflat-48
                simpflat-285 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-50
                                 simpflat-8
                simpflat-287 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-51
                                 simpflat-8
                map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-59
                                                            for_counter-flat-33
                                                            simpflat-285
                map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-60
                                                            for_counter-flat-33
                                                            simpflat-287
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-103
                                            conv-0-simpflat-137
            simpflat-363 = Buf_make# ()
            simpflat-297 = Buf_push#
                             simpflat-363
                             conv-0-simpflat-135
            simpflat-364 = Buf_make# ()
            simpflat-299 = Buf_push#
                             simpflat-364
                             conv-0-simpflat-136
            map_insert_acc_vals-flat-4-simpflat-47 =r map_insert_acc_vals-flat-4-simpflat-47
            map_insert_acc_vals-flat-4-simpflat-47 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-47
                                                        flat-103
                                                        simpflat-297
            map_insert_acc_vals-flat-4-simpflat-48 =r map_insert_acc_vals-flat-4-simpflat-48
            map_insert_acc_vals-flat-4-simpflat-48 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-48
                                                        flat-103
                                                        simpflat-299
        }
        
        flat-104 =r map_insert_acc_keys-flat-3
        flat-105-simpflat-65 =r map_insert_acc_vals-flat-4-simpflat-47
        flat-105-simpflat-66 =r map_insert_acc_vals-flat-4-simpflat-48
        flat-39-simpflat-68 =i ExceptNotAnError : Error
        flat-39-simpflat-69 =i unsafe_Array_create#
                                 0 : Array Time
        flat-39-simpflat-70 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-39-simpflat-71 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-13 = Array_length#
                        flat-104
        
        if (lt# simpflat-13 conv-3)
        {
            flat-39-simpflat-68 =w ExceptNotAnError
            flat-39-simpflat-69 =w flat-104
            flat-39-simpflat-70 =w flat-105-simpflat-65
            flat-39-simpflat-71 =w flat-105-simpflat-66
        }
        else
        {
            flat-39-simpflat-68 =w ExceptCannotCompute
            flat-39-simpflat-69 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-70 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-71 =w unsafe_Array_create#
                                     0
        }
        
        flat-39-simpflat-73 =r flat-39-simpflat-68
        flat-39-simpflat-74 =r flat-39-simpflat-69
        flat-39-simpflat-75 =r flat-39-simpflat-70
        flat-39-simpflat-76 =r flat-39-simpflat-71
        flat-0-simpflat-42 =w flat-39-simpflat-73
        flat-0-simpflat-43 =w flat-39-simpflat-74
        flat-0-simpflat-44 =w flat-39-simpflat-75
        flat-0-simpflat-45 =w flat-39-simpflat-76
    }
    else
    {
        flat-0-simpflat-42 =w conv-36-aval-0-simpflat-37
        flat-0-simpflat-43 =w unsafe_Array_create#
                                0
        flat-0-simpflat-44 =w unsafe_Array_create#
                                0
        flat-0-simpflat-45 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-78 =r flat-0-simpflat-42
    flat-0-simpflat-79 =r flat-0-simpflat-43
    flat-0-simpflat-80 =r flat-0-simpflat-44
    flat-0-simpflat-81 =r flat-0-simpflat-45
    acc-conv-36-simpflat-32 =w flat-0-simpflat-78
    acc-conv-36-simpflat-33 =w flat-0-simpflat-79
    acc-conv-36-simpflat-34 =w flat-0-simpflat-80
    acc-conv-36-simpflat-35 =w flat-0-simpflat-81
}

conv-36-simpflat-83 =r acc-conv-36-simpflat-32
conv-36-simpflat-84 =r acc-conv-36-simpflat-33
conv-36-simpflat-85 =r acc-conv-36-simpflat-34
conv-36-simpflat-86 =r acc-conv-36-simpflat-35
flat-40-simpflat-88 =i ExceptNotAnError : Error
flat-40-simpflat-89 =i unsafe_Array_create#
                         0 : Array Time
flat-40-simpflat-90 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-36-simpflat-83
      ExceptNotAnError)
{
    flat-48-simpflat-91 =i ExceptNotAnError : Error
    flat-48-simpflat-92 =i unsafe_Array_create#
                             0 : Array Time
    flat-48-simpflat-93 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-49 in 0 .. Array_length#
                                           conv-36-simpflat-84)
    {
        flat-48-simpflat-94 =r flat-48-simpflat-91
        flat-48-simpflat-95 =r flat-48-simpflat-92
        flat-48-simpflat-96 =r flat-48-simpflat-93
        simpflat-321 = unsafe_Array_index#
                         conv-36-simpflat-84
                         for_counter-flat-49
        simpflat-323 = unsafe_Array_index#
                         conv-36-simpflat-85
                         for_counter-flat-49
        simpflat-325 = unsafe_Array_index#
                         conv-36-simpflat-86
                         for_counter-flat-49
        flat-51-simpflat-97 =i ExceptNotAnError : Error
        flat-51-simpflat-98 =i unsafe_Array_create#
                                 0 : Array Time
        flat-51-simpflat-99 =i unsafe_Array_create#
                                 0 : Array Int
        
        if (eq#
              flat-48-simpflat-94
              ExceptNotAnError)
        {
            simpflat-337 = Buf_read#
                             simpflat-323
            simpflat-339 = Buf_read#
                             simpflat-325
            flat-55-simpflat-100 =i ExceptNotAnError : Error
            flat-55-simpflat-101 =i 0 : Int
            
            foreach (for_counter-flat-94 in 0 .. Array_length#
                                                   simpflat-337)
            {
                flat-55-simpflat-102 =r flat-55-simpflat-100
                flat-55-simpflat-103 =r flat-55-simpflat-101
                simpflat-344 = unsafe_Array_index#
                                 simpflat-337
                                 for_counter-flat-94
                simpflat-346 = unsafe_Array_index#
                                 simpflat-339
                                 for_counter-flat-94
                flat-96-simpflat-104 =i ExceptNotAnError : Error
                flat-96-simpflat-105 =i 0 : Int
                
                if (eq#
                      simpflat-344
                      ExceptNotAnError)
                {
                    flat-99-simpflat-106 =i ExceptNotAnError : Error
                    flat-99-simpflat-107 =i 0 : Int
                    
                    if (eq#
                          flat-55-simpflat-102
                          ExceptNotAnError)
                    {
                        simpflat-16 = add#
                                        simpflat-346
                                        flat-55-simpflat-103
                        flat-99-simpflat-106 =w ExceptNotAnError
                        flat-99-simpflat-107 =w simpflat-16
                    }
                    else
                    {
                        flat-99-simpflat-106 =w flat-55-simpflat-102
                        flat-99-simpflat-107 =w 0
                    }
                    
                    flat-99-simpflat-108 =r flat-99-simpflat-106
                    flat-99-simpflat-109 =r flat-99-simpflat-107
                    flat-96-simpflat-104 =w flat-99-simpflat-108
                    flat-96-simpflat-105 =w flat-99-simpflat-109
                }
                else
                {
                    flat-96-simpflat-104 =w simpflat-344
                    flat-96-simpflat-105 =w 0
                }
                
                flat-96-simpflat-110 =r flat-96-simpflat-104
                flat-96-simpflat-111 =r flat-96-simpflat-105
                flat-55-simpflat-100 =w flat-96-simpflat-110
                flat-55-simpflat-101 =w flat-96-simpflat-111
            }
            
            flat-107-simpflat-112 =r flat-55-simpflat-100
            flat-107-simpflat-113 =r flat-55-simpflat-101
            flat-56-simpflat-114 =i ExceptNotAnError : Error
            flat-56-simpflat-115 =i unsafe_Array_create#
                                      0 : Array Time
            flat-56-simpflat-116 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-107-simpflat-112
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-59 =i flat-48-simpflat-95 : Array Time
                map_insert_acc_vals-flat-60 =i flat-48-simpflat-96 : Array Int
                map_insert_acc_bs_found-flat-62 =i False : Bool
                map_insert_acc_bs_index-flat-61 =i -1 : Int
                map_insert_loc_keys-flat-63 =r map_insert_acc_keys-flat-59
                map_insert_loc_vals-flat-64 =r map_insert_acc_vals-flat-60
                map_insert_size-flat-68 = Array_length#
                                            map_insert_loc_keys-flat-63
                bs_acc_found-flat-76 =i False : Bool
                bs_acc_mid-flat-73 =i -1 : Int
                bs_acc_ins-flat-75 =i -1 : Int
                bs_acc_low-flat-81 =i 0 : Int
                bs_acc_high-flat-82 =i sub#
                                         map_insert_size-flat-68
                                         1 : Int
                bs_acc_end-flat-83 =i False : Bool
                
                while (bs_acc_end-flat-83 == False)
                {
                    bs_loc_low-flat-79 =r bs_acc_low-flat-81
                    bs_loc_high-flat-80 =r bs_acc_high-flat-82
                    
                    if (gt#
                          bs_loc_low-flat-79
                          bs_loc_high-flat-80)
                    {
                        bs_acc_end-flat-83 =w True
                        bs_acc_ins-flat-75 =w bs_loc_low-flat-79
                    }
                    else
                    {
                        simpflat-19 = add#
                                        bs_loc_low-flat-79
                                        bs_loc_high-flat-80
                        simpflat-20 = doubleOfInt#
                                        simpflat-19
                        simpflat-21 = div#
                                        simpflat-20
                                        2.0
                        bs_acc_mid-flat-73 =w floor#
                                                simpflat-21
                        bs_loc_mid-flat-77 =r bs_acc_mid-flat-73
                        bs_loc_x-flat-78 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-63
                                             bs_loc_mid-flat-77
                        
                        if (eq#
                              bs_loc_x-flat-78
                              simpflat-321)
                        {
                            bs_acc_end-flat-83 =w True
                            bs_acc_found-flat-76 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-78
                                  simpflat-321)
                            {
                                bs_acc_low-flat-81 =w add#
                                                        bs_loc_mid-flat-77
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-82 =w sub#
                                                         bs_loc_mid-flat-77
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-71 =r bs_acc_found-flat-76
                bs_loc_mid-flat-72 =r bs_acc_mid-flat-73
                bs_loc_ins-flat-74 =r bs_acc_ins-flat-75
                
                if (eq#
                      bs_loc_found-flat-71
                      True)
                {
                    map_insert_acc_bs_found-flat-62 =w True
                    map_insert_acc_bs_index-flat-61 =w bs_loc_mid-flat-72
                }
                else
                {
                    map_insert_acc_bs_found-flat-62 =w False
                    map_insert_acc_bs_index-flat-61 =w bs_loc_ins-flat-74
                }
                
                flat-108 =r map_insert_acc_bs_found-flat-62
                flat-109 =r map_insert_acc_bs_index-flat-61
                
                if (eq# flat-108 True)
                {
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-113
                }
                else
                {
                    copy_array-flat-86 =r map_insert_acc_keys-flat-59
                    simpflat-22 = Array_length#
                                    copy_array-flat-86
                    
                    if (eq# simpflat-22 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-23 = unsafe_Array_index#
                                        copy_array-flat-86
                                        0
                        map_insert_acc_keys-flat-59 =w Array_put_immutable#
                                                         copy_array-flat-86
                                                         0
                                                         simpflat-23
                    }
                    
                    copy_array-flat-87 =r map_insert_acc_vals-flat-60
                    simpflat-24 = Array_length#
                                    copy_array-flat-87
                    
                    if (eq# simpflat-24 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-25 = unsafe_Array_index#
                                        copy_array-flat-87
                                        0
                        map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                         copy_array-flat-87
                                                         0
                                                         simpflat-25
                    }
                    
                    
                    foreach (for_counter-flat-88 in map_insert_size-flat-68 .. flat-109)
                    {
                        update_acc-flat-89 =r map_insert_acc_keys-flat-59
                        simpflat-26 = sub#
                                        for_counter-flat-88
                                        1
                        simpflat-27 = unsafe_Array_index#
                                        map_insert_loc_keys-flat-63
                                        simpflat-26
                        map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                         update_acc-flat-89
                                                         for_counter-flat-88
                                                         simpflat-27
                        update_acc-flat-90 =r map_insert_acc_vals-flat-60
                        simpflat-29 = unsafe_Array_index#
                                        map_insert_loc_vals-flat-64
                                        simpflat-26
                        map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                         update_acc-flat-90
                                                         for_counter-flat-88
                                                         simpflat-29
                    }
                    
                    map_insert_acc_keys-flat-59 =r map_insert_acc_keys-flat-59
                    map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-59
                                                     flat-109
                                                     simpflat-321
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-113
                }
                
                flat-110 =r map_insert_acc_keys-flat-59
                flat-111 =r map_insert_acc_vals-flat-60
                flat-93-simpflat-117 =i ExceptNotAnError : Error
                flat-93-simpflat-118 =i unsafe_Array_create#
                                          0 : Array Time
                flat-93-simpflat-119 =i unsafe_Array_create#
                                          0 : Array Int
                simpflat-31 = Array_length#
                                flat-110
                
                if (lt# simpflat-31 conv-3)
                {
                    flat-93-simpflat-117 =w ExceptNotAnError
                    flat-93-simpflat-118 =w flat-110
                    flat-93-simpflat-119 =w flat-111
                }
                else
                {
                    flat-93-simpflat-117 =w ExceptCannotCompute
                    flat-93-simpflat-118 =w unsafe_Array_create#
                                              0
                    flat-93-simpflat-119 =w unsafe_Array_create#
                                              0
                }
                
                flat-93-simpflat-120 =r flat-93-simpflat-117
                flat-93-simpflat-121 =r flat-93-simpflat-118
                flat-93-simpflat-122 =r flat-93-simpflat-119
                flat-56-simpflat-114 =w flat-93-simpflat-120
                flat-56-simpflat-115 =w flat-93-simpflat-121
                flat-56-simpflat-116 =w flat-93-simpflat-122
            }
            else
            {
                flat-56-simpflat-114 =w flat-107-simpflat-112
                flat-56-simpflat-115 =w unsafe_Array_create#
                                          0
                flat-56-simpflat-116 =w unsafe_Array_create#
                                          0
            }
            
            flat-56-simpflat-123 =r flat-56-simpflat-114
            flat-56-simpflat-124 =r flat-56-simpflat-115
            flat-56-simpflat-125 =r flat-56-simpflat-116
            flat-51-simpflat-97 =w flat-56-simpflat-123
            flat-51-simpflat-98 =w flat-56-simpflat-124
            flat-51-simpflat-99 =w flat-56-simpflat-125
        }
        else
        {
            flat-51-simpflat-97 =w flat-48-simpflat-94
            flat-51-simpflat-98 =w unsafe_Array_create#
                                     0
            flat-51-simpflat-99 =w unsafe_Array_create#
                                     0
        }
        
        flat-51-simpflat-126 =r flat-51-simpflat-97
        flat-51-simpflat-127 =r flat-51-simpflat-98
        flat-51-simpflat-128 =r flat-51-simpflat-99
        flat-48-simpflat-91 =w flat-51-simpflat-126
        flat-48-simpflat-92 =w flat-51-simpflat-127
        flat-48-simpflat-93 =w flat-51-simpflat-128
    }
    
    flat-112-simpflat-129 =r flat-48-simpflat-91
    flat-112-simpflat-130 =r flat-48-simpflat-92
    flat-112-simpflat-131 =r flat-48-simpflat-93
    flat-40-simpflat-88 =w flat-112-simpflat-129
    flat-40-simpflat-89 =w flat-112-simpflat-130
    flat-40-simpflat-90 =w flat-112-simpflat-131
}
else
{
    flat-40-simpflat-88 =w conv-36-simpflat-83
    flat-40-simpflat-89 =w unsafe_Array_create#
                             0
    flat-40-simpflat-90 =w unsafe_Array_create#
                             0
}

flat-40-simpflat-132 =r flat-40-simpflat-88
flat-40-simpflat-133 =r flat-40-simpflat-89
flat-40-simpflat-134 =r flat-40-simpflat-90

output repl:output : Sum Error (Map Time Int) =
    flat-40-simpflat-132 : Error
  , flat-40-simpflat-133 : Array Time
  , flat-40-simpflat-134 : Array Int

Core evaluation
---------------

homer|[ (1989-12-17, 100)
      , (1990-01-01, 200)
      , (1994-01-01, 300)
      , (1999-01-01, 400)
      , (2010-01-01, 500)
      ]
marge|[ (1989-12-17, 30) ]

λ λ λ 
Queries will no longer be evaluated using the C evaluator.
Snapshot mode activated with a snapshot date of 2017-01-01.
Loaded dictionary with 5 inputs, 0 outputs, 73 functions.
Selected psv file as input: test/cli/repl/data.psv

  ██▓ ▄████▄   ██▓ ▄████▄   ██▓    ▓█████
 ▓██▒▒██▀ ▀█  ▓██▒▒██▀ ▀█  ▓██▒    ▓█   ▀
 ▒██▒▒▓█    ▄ ▒██▒▒▓█    ▄ ▒██░    ▒███
 ░██░▒▓▓▄ ▄██▒░██░▒▓▓▄ ▄██▒▒██░    ▒▓█  ▄
 ░██░▒ ▓███▀ ░░██░▒ ▓███▀ ░░██████▒░▒████▒
 ░▓  ░ ░▒ ▒  ░░▓  ░ ░▒ ▒  ░░ ▒░▓  ░░░ ▒░ ░
  ▒ ░  ░  ▒    ▒ ░  ░  ▒   ░ ░ ▒  ░ ░ ░  ░
  ▒ ░░         ▒ ░░          ░ ░ REPL ░
  ░  ░ ░       ░  ░ ░          ░  ░   ░  ░
     ░            ░
                  ░     :help for help

λ -- Show everything
λ The core will be simplified prior to evaluation.
The flattened simplified avalanche will be shown during evaluation.
λ λ -- A rather complicated feature to convert to Avalanche
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-32-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-32-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-32 : Error
        , conv-0-simpflat-33 : Int
        , conv-0-simpflat-34 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-32
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-33
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-32
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-32
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-32-simpflat-2 =r acc-conv-32-simpflat-2
    acc-conv-32-simpflat-2 =w Buf_push#
                                acc-conv-32-simpflat-2
                                conv-0-simpflat-32
    acc-conv-32-simpflat-3 =r acc-conv-32-simpflat-3
    acc-conv-32-simpflat-3 =w Buf_push#
                                acc-conv-32-simpflat-3
                                conv-0-simpflat-33
}

conv-32-simpflat-16 =r acc-conv-32-simpflat-2
conv-32-simpflat-17 =r acc-conv-32-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
}

flat-10-simpflat-22 =r flat-10-simpflat-20
flat-10-simpflat-23 =r flat-10-simpflat-21
flat-11-simpflat-24 =i ExceptNotAnError : Error
flat-11-simpflat-25 =i 0 : Int
flat-11-simpflat-26 =i unsafe_Array_create#
                         0 : Array Error
flat-11-simpflat-27 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      flat-10-simpflat-22
      ExceptNotAnError)
{
    flat-11-simpflat-24 =w ExceptNotAnError
    flat-11-simpflat-25 =w flat-10-simpflat-23
    flat-11-simpflat-26 =w Buf_read#
                             conv-32-simpflat-16
    flat-11-simpflat-27 =w Buf_read#
                             conv-32-simpflat-17
}
else
{
    flat-11-simpflat-24 =w flat-10-simpflat-22
    flat-11-simpflat-25 =w 0
    flat-11-simpflat-26 =w unsafe_Array_create#
                             0
    flat-11-simpflat-27 =w unsafe_Array_create#
                             0
}

flat-11-simpflat-28 =r flat-11-simpflat-24
flat-11-simpflat-29 =r flat-11-simpflat-25
flat-11-simpflat-30 =r flat-11-simpflat-26
flat-11-simpflat-31 =r flat-11-simpflat-27

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-11-simpflat-28 : Error
  , flat-11-simpflat-29 : Int
  , flat-11-simpflat-30 : Array Error
  , flat-11-simpflat-31 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-32-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-32-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-32 : Error
        , conv-0-simpflat-33 : Int
        , conv-0-simpflat-34 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-32
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-33
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-32
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-32
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-32-simpflat-2 =r acc-conv-32-simpflat-2
    acc-conv-32-simpflat-2 =w Buf_push#
                                acc-conv-32-simpflat-2
                                conv-0-simpflat-32
    acc-conv-32-simpflat-3 =r acc-conv-32-simpflat-3
    acc-conv-32-simpflat-3 =w Buf_push#
                                acc-conv-32-simpflat-3
                                conv-0-simpflat-33
}

conv-32-simpflat-16 =r acc-conv-32-simpflat-2
conv-32-simpflat-17 =r acc-conv-32-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
}

flat-10-simpflat-22 =r flat-10-simpflat-20
flat-10-simpflat-23 =r flat-10-simpflat-21
flat-11-simpflat-24 =i ExceptNotAnError : Error
flat-11-simpflat-25 =i 0 : Int
flat-11-simpflat-26 =i unsafe_Array_create#
                         0 : Array Error
flat-11-simpflat-27 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      flat-10-simpflat-22
      ExceptNotAnError)
{
    flat-11-simpflat-24 =w ExceptNotAnError
    flat-11-simpflat-25 =w flat-10-simpflat-23
    flat-11-simpflat-26 =w Buf_read#
                             conv-32-simpflat-16
    flat-11-simpflat-27 =w Buf_read#
                             conv-32-simpflat-17
}
else
{
    flat-11-simpflat-24 =w flat-10-simpflat-22
    flat-11-simpflat-25 =w 0
    flat-11-simpflat-26 =w unsafe_Array_create#
                             0
    flat-11-simpflat-27 =w unsafe_Array_create#
                             0
}

flat-11-simpflat-28 =r flat-11-simpflat-24
flat-11-simpflat-29 =r flat-11-simpflat-25
flat-11-simpflat-30 =r flat-11-simpflat-26
flat-11-simpflat-31 =r flat-11-simpflat-27

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-11-simpflat-28 : Error
  , flat-11-simpflat-29 : Int
  , flat-11-simpflat-30 : Array Error
  , flat-11-simpflat-31 : Array Int

Core evaluation
---------------

homer|(5, [ 300 , 400 , 500 ])
marge|(1, [ 0 , 10 , 20 ])

λ λ -- Something involves the abstract buffer type
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-34-simpflat-30 =i ExceptNotAnError : Error
acc-conv-34-simpflat-31 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-34-simpflat-32 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-34-simpflat-33 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-127 : Error
        , conv-0-simpflat-128 : Int
        , conv-0-simpflat-129 : Time {
    conv-34-aval-0-simpflat-35 =r acc-conv-34-simpflat-30
    conv-34-aval-0-simpflat-36 =r acc-conv-34-simpflat-31
    conv-34-aval-0-simpflat-37 =r acc-conv-34-simpflat-32
    conv-34-aval-0-simpflat-38 =r acc-conv-34-simpflat-33
    flat-0-simpflat-40 =i ExceptNotAnError : Error
    flat-0-simpflat-41 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-42 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-43 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-34-aval-0-simpflat-35
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-34-aval-0-simpflat-36 : Array Time
        map_insert_acc_vals-flat-4-simpflat-45 =i conv-34-aval-0-simpflat-37 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-46 =i conv-34-aval-0-simpflat-38 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_loc_vals-flat-8-simpflat-48 =r map_insert_acc_vals-flat-4-simpflat-45
        map_insert_loc_vals-flat-8-simpflat-49 =r map_insert_acc_vals-flat-4-simpflat-46
        map_insert_size-flat-12 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-20 =i False : Bool
        bs_acc_mid-flat-17 =i -1 : Int
        bs_acc_ins-flat-19 =i -1 : Int
        bs_acc_low-flat-25 =i 0 : Int
        bs_acc_high-flat-26 =i sub#
                                 map_insert_size-flat-12
                                 1 : Int
        bs_acc_end-flat-27 =i False : Bool
        
        while (bs_acc_end-flat-27 == False)
        {
            bs_loc_low-flat-23 =r bs_acc_low-flat-25
            bs_loc_high-flat-24 =r bs_acc_high-flat-26
            
            if (gt#
                  bs_loc_low-flat-23
                  bs_loc_high-flat-24)
            {
                bs_acc_end-flat-27 =w True
                bs_acc_ins-flat-19 =w bs_loc_low-flat-23
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-23
                               bs_loc_high-flat-24
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-17 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-21 =r bs_acc_mid-flat-17
                bs_loc_x-flat-22 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-21
                
                if (eq#
                      bs_loc_x-flat-22
                      conv-0-simpflat-129)
                {
                    bs_acc_end-flat-27 =w True
                    bs_acc_found-flat-20 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-22
                          conv-0-simpflat-129)
                    {
                        bs_acc_low-flat-25 =w add#
                                                bs_loc_mid-flat-21
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-26 =w sub#
                                                 bs_loc_mid-flat-21
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-15 =r bs_acc_found-flat-20
        bs_loc_mid-flat-16 =r bs_acc_mid-flat-17
        bs_loc_ins-flat-18 =r bs_acc_ins-flat-19
        
        if (eq#
              bs_loc_found-flat-15
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-16
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-18
        }
        
        flat-101 =r map_insert_acc_bs_found-flat-6
        flat-102 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-101 True)
        {
            simpflat-240 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-48
                             flat-102
            simpflat-242 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-49
                             flat-102
            simpflat-247 = Buf_push#
                             simpflat-240
                             conv-0-simpflat-127
            simpflat-250 = Buf_push#
                             simpflat-242
                             conv-0-simpflat-128
            map_insert_acc_vals-flat-4-simpflat-45 =r map_insert_acc_vals-flat-4-simpflat-45
            map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-45
                                                        flat-102
                                                        simpflat-247
            map_insert_acc_vals-flat-4-simpflat-46 =r map_insert_acc_vals-flat-4-simpflat-46
            map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-46
                                                        flat-102
                                                        simpflat-250
        }
        else
        {
            copy_array-flat-31 =r map_insert_acc_keys-flat-3
            simpflat-4 = Array_length#
                           copy_array-flat-31
            
            if (eq# simpflat-4 0)
            {
                
            }
            else
            {
                simpflat-5 = unsafe_Array_index#
                               copy_array-flat-31
                               0
                map_insert_acc_keys-flat-3 =w Array_put_immutable#
                                                copy_array-flat-31
                                                0
                                                simpflat-5
            }
            
            copy_array-flat-32-simpflat-54 =r map_insert_acc_vals-flat-4-simpflat-45
            copy_array-flat-32-simpflat-55 =r map_insert_acc_vals-flat-4-simpflat-46
            simpflat-6 = Array_length#
                           copy_array-flat-32-simpflat-54
            
            if (eq# simpflat-6 0)
            {
                
            }
            else
            {
                simpflat-262 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-54
                                 0
                simpflat-264 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-55
                                 0
                map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-54
                                                            0
                                                            simpflat-262
                map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-55
                                                            0
                                                            simpflat-264
            }
            
            
            foreach (for_counter-flat-33 in map_insert_size-flat-12 .. flat-102)
            {
                update_acc-flat-34 =r map_insert_acc_keys-flat-3
                simpflat-8 = sub#
                               for_counter-flat-33
                               1
                simpflat-9 = unsafe_Array_index#
                               map_insert_loc_keys-flat-7
                               simpflat-8
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-34
                                                for_counter-flat-33
                                                simpflat-9
                update_acc-flat-35-simpflat-57 =r map_insert_acc_vals-flat-4-simpflat-45
                update_acc-flat-35-simpflat-58 =r map_insert_acc_vals-flat-4-simpflat-46
                simpflat-274 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-48
                                 simpflat-8
                simpflat-276 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-49
                                 simpflat-8
                map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-57
                                                            for_counter-flat-33
                                                            simpflat-274
                map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-58
                                                            for_counter-flat-33
                                                            simpflat-276
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-102
                                            conv-0-simpflat-129
            simpflat-351 = Buf_make# ()
            simpflat-286 = Buf_push#
                             simpflat-351
                             conv-0-simpflat-127
            simpflat-352 = Buf_make# ()
            simpflat-288 = Buf_push#
                             simpflat-352
                             conv-0-simpflat-128
            map_insert_acc_vals-flat-4-simpflat-45 =r map_insert_acc_vals-flat-4-simpflat-45
            map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-45
                                                        flat-102
                                                        simpflat-286
            map_insert_acc_vals-flat-4-simpflat-46 =r map_insert_acc_vals-flat-4-simpflat-46
            map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-46
                                                        flat-102
                                                        simpflat-288
        }
        
        flat-103 =r map_insert_acc_keys-flat-3
        flat-104-simpflat-63 =r map_insert_acc_vals-flat-4-simpflat-45
        flat-104-simpflat-64 =r map_insert_acc_vals-flat-4-simpflat-46
        flat-39-simpflat-66 =i ExceptNotAnError : Error
        flat-39-simpflat-67 =i unsafe_Array_create#
                                 0 : Array Time
        flat-39-simpflat-68 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-39-simpflat-69 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-13 = Array_length#
                        flat-103
        
        if (lt# simpflat-13 conv-3)
        {
            flat-39-simpflat-66 =w ExceptNotAnError
            flat-39-simpflat-67 =w flat-103
            flat-39-simpflat-68 =w flat-104-simpflat-63
            flat-39-simpflat-69 =w flat-104-simpflat-64
        }
        else
        {
            flat-39-simpflat-66 =w ExceptCannotCompute
            flat-39-simpflat-67 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-68 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-69 =w unsafe_Array_create#
                                     0
        }
        
        flat-39-simpflat-71 =r flat-39-simpflat-66
        flat-39-simpflat-72 =r flat-39-simpflat-67
        flat-39-simpflat-73 =r flat-39-simpflat-68
        flat-39-simpflat-74 =r flat-39-simpflat-69
        flat-0-simpflat-40 =w flat-39-simpflat-71
        flat-0-simpflat-41 =w flat-39-simpflat-72
        flat-0-simpflat-42 =w flat-39-simpflat-73
        flat-0-simpflat-43 =w flat-39-simpflat-74
    }
    else
    {
        flat-0-simpflat-40 =w conv-34-aval-0-simpflat-35
        flat-0-simpflat-41 =w unsafe_Array_create#
                                0
        flat-0-simpflat-42 =w unsafe_Array_create#
                                0
        flat-0-simpflat-43 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-76 =r flat-0-simpflat-40
    flat-0-simpflat-77 =r flat-0-simpflat-41
    flat-0-simpflat-78 =r flat-0-simpflat-42
    flat-0-simpflat-79 =r flat-0-simpflat-43
    acc-conv-34-simpflat-30 =w flat-0-simpflat-76
    acc-conv-34-simpflat-31 =w flat-0-simpflat-77
    acc-conv-34-simpflat-32 =w flat-0-simpflat-78
    acc-conv-34-simpflat-33 =w flat-0-simpflat-79
}

conv-34-simpflat-81 =r acc-conv-34-simpflat-30
conv-34-simpflat-82 =r acc-conv-34-simpflat-31
conv-34-simpflat-83 =r acc-conv-34-simpflat-32
conv-34-simpflat-84 =r acc-conv-34-simpflat-33
flat-40-simpflat-86 =i ExceptNotAnError : Error
flat-40-simpflat-87 =i unsafe_Array_create#
                         0 : Array Time
flat-40-simpflat-88 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-34-simpflat-81
      ExceptNotAnError)
{
    flat-48-simpflat-89 =i ExceptNotAnError : Error
    flat-48-simpflat-90 =i unsafe_Array_create#
                             0 : Array Time
    flat-48-simpflat-91 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-49 in 0 .. Array_length#
                                           conv-34-simpflat-82)
    {
        flat-48-simpflat-92 =r flat-48-simpflat-89
        flat-48-simpflat-93 =r flat-48-simpflat-90
        flat-48-simpflat-94 =r flat-48-simpflat-91
        simpflat-310 = unsafe_Array_index#
                         conv-34-simpflat-82
                         for_counter-flat-49
        simpflat-312 = unsafe_Array_index#
                         conv-34-simpflat-83
                         for_counter-flat-49
        simpflat-314 = unsafe_Array_index#
                         conv-34-simpflat-84
                         for_counter-flat-49
        flat-51-simpflat-95 =i ExceptNotAnError : Error
        flat-51-simpflat-96 =i unsafe_Array_create#
                                 0 : Array Time
        flat-51-simpflat-97 =i unsafe_Array_create#
                                 0 : Array Int
        
        if (eq#
              flat-48-simpflat-92
              ExceptNotAnError)
        {
            simpflat-326 = Buf_read#
                             simpflat-312
            simpflat-328 = Buf_read#
                             simpflat-314
            flat-55-simpflat-98 =i ExceptNotAnError : Error
            flat-55-simpflat-99 =i 0 : Int
            
            foreach (for_counter-flat-93 in 0 .. Array_length#
                                                   simpflat-326)
            {
                flat-55-simpflat-100 =r flat-55-simpflat-98
                flat-55-simpflat-101 =r flat-55-simpflat-99
                simpflat-333 = unsafe_Array_index#
                                 simpflat-326
                                 for_counter-flat-93
                simpflat-335 = unsafe_Array_index#
                                 simpflat-328
                                 for_counter-flat-93
                flat-95-simpflat-102 =i ExceptNotAnError : Error
                flat-95-simpflat-103 =i 0 : Int
                
                if (eq#
                      simpflat-333
                      ExceptNotAnError)
                {
                    flat-98-simpflat-104 =i ExceptNotAnError : Error
                    flat-98-simpflat-105 =i 0 : Int
                    
                    if (eq#
                          flat-55-simpflat-100
                          ExceptNotAnError)
                    {
                        simpflat-16 = add#
                                        simpflat-335
                                        flat-55-simpflat-101
                        flat-98-simpflat-104 =w ExceptNotAnError
                        flat-98-simpflat-105 =w simpflat-16
                    }
                    else
                    {
                        flat-98-simpflat-104 =w flat-55-simpflat-100
                        flat-98-simpflat-105 =w 0
                    }
                    
                    flat-98-simpflat-106 =r flat-98-simpflat-104
                    flat-98-simpflat-107 =r flat-98-simpflat-105
                    flat-95-simpflat-102 =w flat-98-simpflat-106
                    flat-95-simpflat-103 =w flat-98-simpflat-107
                }
                else
                {
                    flat-95-simpflat-102 =w simpflat-333
                    flat-95-simpflat-103 =w 0
                }
                
                flat-95-simpflat-108 =r flat-95-simpflat-102
                flat-95-simpflat-109 =r flat-95-simpflat-103
                flat-55-simpflat-98 =w flat-95-simpflat-108
                flat-55-simpflat-99 =w flat-95-simpflat-109
            }
            
            flat-106-simpflat-110 =r flat-55-simpflat-98
            flat-106-simpflat-111 =r flat-55-simpflat-99
            flat-56-simpflat-112 =i ExceptNotAnError : Error
            flat-56-simpflat-113 =i unsafe_Array_create#
                                      0 : Array Time
            flat-56-simpflat-114 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-106-simpflat-110
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-59 =i flat-48-simpflat-93 : Array Time
                map_insert_acc_vals-flat-60 =i flat-48-simpflat-94 : Array Int
                map_insert_acc_bs_found-flat-62 =i False : Bool
                map_insert_acc_bs_index-flat-61 =i -1 : Int
                map_insert_loc_keys-flat-63 =r map_insert_acc_keys-flat-59
                map_insert_loc_vals-flat-64 =r map_insert_acc_vals-flat-60
                map_insert_size-flat-68 = Array_length#
                                            map_insert_loc_keys-flat-63
                bs_acc_found-flat-76 =i False : Bool
                bs_acc_mid-flat-73 =i -1 : Int
                bs_acc_ins-flat-75 =i -1 : Int
                bs_acc_low-flat-81 =i 0 : Int
                bs_acc_high-flat-82 =i sub#
                                         map_insert_size-flat-68
                                         1 : Int
                bs_acc_end-flat-83 =i False : Bool
                
                while (bs_acc_end-flat-83 == False)
                {
                    bs_loc_low-flat-79 =r bs_acc_low-flat-81
                    bs_loc_high-flat-80 =r bs_acc_high-flat-82
                    
                    if (gt#
                          bs_loc_low-flat-79
                          bs_loc_high-flat-80)
                    {
                        bs_acc_end-flat-83 =w True
                        bs_acc_ins-flat-75 =w bs_loc_low-flat-79
                    }
                    else
                    {
                        simpflat-19 = add#
                                        bs_loc_low-flat-79
                                        bs_loc_high-flat-80
                        simpflat-20 = doubleOfInt#
                                        simpflat-19
                        simpflat-21 = div#
                                        simpflat-20
                                        2.0
                        bs_acc_mid-flat-73 =w floor#
                                                simpflat-21
                        bs_loc_mid-flat-77 =r bs_acc_mid-flat-73
                        bs_loc_x-flat-78 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-63
                                             bs_loc_mid-flat-77
                        
                        if (eq#
                              bs_loc_x-flat-78
                              simpflat-310)
                        {
                            bs_acc_end-flat-83 =w True
                            bs_acc_found-flat-76 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-78
                                  simpflat-310)
                            {
                                bs_acc_low-flat-81 =w add#
                                                        bs_loc_mid-flat-77
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-82 =w sub#
                                                         bs_loc_mid-flat-77
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-71 =r bs_acc_found-flat-76
                bs_loc_mid-flat-72 =r bs_acc_mid-flat-73
                bs_loc_ins-flat-74 =r bs_acc_ins-flat-75
                
                if (eq#
                      bs_loc_found-flat-71
                      True)
                {
                    map_insert_acc_bs_found-flat-62 =w True
                    map_insert_acc_bs_index-flat-61 =w bs_loc_mid-flat-72
                }
                else
                {
                    map_insert_acc_bs_found-flat-62 =w False
                    map_insert_acc_bs_index-flat-61 =w bs_loc_ins-flat-74
                }
                
                flat-107 =r map_insert_acc_bs_found-flat-62
                flat-108 =r map_insert_acc_bs_index-flat-61
                
                if (eq# flat-107 True)
                {
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-108
                                                     flat-106-simpflat-111
                }
                else
                {
                    copy_array-flat-86 =r map_insert_acc_keys-flat-59
                    simpflat-22 = Array_length#
                                    copy_array-flat-86
                    
                    if (eq# simpflat-22 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-23 = unsafe_Array_index#
                                        copy_array-flat-86
                                        0
                        map_insert_acc_keys-flat-59 =w Array_put_immutable#
                                                         copy_array-flat-86
                                                         0
                                                         simpflat-23
                    }
                    
                    copy_array-flat-87 =r map_insert_acc_vals-flat-60
                    simpflat-24 = Array_length#
                                    copy_array-flat-87
                    
                    if (eq# simpflat-24 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-25 = unsafe_Array_index#
                                        copy_array-flat-87
                                        0
                        map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                         copy_array-flat-87
                                                         0
                                                         simpflat-25
                    }
                    
                    
                    foreach (for_counter-flat-88 in map_insert_size-flat-68 .. flat-108)
                    {
                        update_acc-flat-89 =r map_insert_acc_keys-flat-59
                        simpflat-26 = sub#
                                        for_counter-flat-88
                                        1
                        simpflat-27 = unsafe_Array_index#
                                        map_insert_loc_keys-flat-63
                                        simpflat-26
                        map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                         update_acc-flat-89
                                                         for_counter-flat-88
                                                         simpflat-27
                        update_acc-flat-90 =r map_insert_acc_vals-flat-60
                        simpflat-29 = unsafe_Array_index#
                                        map_insert_loc_vals-flat-64
                                        simpflat-26
                        map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                         update_acc-flat-90
                                                         for_counter-flat-88
                                                         simpflat-29
                    }
                    
                    map_insert_acc_keys-flat-59 =r map_insert_acc_keys-flat-59
                    map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-59
                                                     flat-108
                                                     simpflat-310
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-108
                                                     flat-106-simpflat-111
                }
                
                flat-109 =r map_insert_acc_keys-flat-59
                flat-110 =r map_insert_acc_vals-flat-60
                flat-56-simpflat-112 =w ExceptNotAnError
                flat-56-simpflat-113 =w flat-109
                flat-56-simpflat-114 =w flat-110
            }
            else
            {
                flat-56-simpflat-112 =w flat-106-simpflat-110
                flat-56-simpflat-113 =w unsafe_Array_create#
                                          0
                flat-56-simpflat-114 =w unsafe_Array_create#
                                          0
            }
            
            flat-56-simpflat-115 =r flat-56-simpflat-112
            flat-56-simpflat-116 =r flat-56-simpflat-113
            flat-56-simpflat-117 =r flat-56-simpflat-114
            flat-51-simpflat-95 =w flat-56-simpflat-115
            flat-51-simpflat-96 =w flat-56-simpflat-116
            flat-51-simpflat-97 =w flat-56-simpflat-117
        }
        else
        {
            flat-51-simpflat-95 =w flat-48-simpflat-92
            flat-51-simpflat-96 =w unsafe_Array_create#
                                     0
            flat-51-simpflat-97 =w unsafe_Array_create#
                                     0
        }
        
        flat-51-simpflat-118 =r flat-51-simpflat-95
        flat-51-simpflat-119 =r flat-51-simpflat-96
        flat-51-simpflat-120 =r flat-51-simpflat-97
        flat-48-simpflat-89 =w flat-51-simpflat-118
        flat-48-simpflat-90 =w flat-51-simpflat-119
        flat-48-simpflat-91 =w flat-51-simpflat-120
    }
    
    flat-111-simpflat-121 =r flat-48-simpflat-89
    flat-111-simpflat-122 =r flat-48-simpflat-90
    flat-111-simpflat-123 =r flat-48-simpflat-91
    flat-40-simpflat-86 =w flat-111-simpflat-121
    flat-40-simpflat-87 =w flat-111-simpflat-122
    flat-40-simpflat-88 =w flat-111-simpflat-123
}
else
{
    flat-40-simpflat-86 =w conv-34-simpflat-81
    flat-40-simpflat-87 =w unsafe_Array_create#
                             0
    flat-40-simpflat-88 =w unsafe_Array_create#
                             0
}

flat-40-simpflat-124 =r flat-40-simpflat-86
flat-40-simpflat-125 =r flat-40-simpflat-87
flat-40-simpflat-126 =r flat-40-simpflat-88

output repl:output : Sum Error (Map Time Int) =
    flat-40-simpflat-124 : Error
  , flat-40-simpflat-125 : Array Time
  , flat-40-simpflat-126 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-34-simpflat-30 =i ExceptNotAnError : Error
acc-conv-34-simpflat-31 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-34-simpflat-32 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-34-simpflat-33 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-127 : Error
        , conv-0-simpflat-128 : Int
        , conv-0-simpflat-129 : Time {
    conv-34-aval-0-simpflat-35 =r acc-conv-34-simpflat-30
    conv-34-aval-0-simpflat-36 =r acc-conv-34-simpflat-31
    conv-34-aval-0-simpflat-37 =r acc-conv-34-simpflat-32
    conv-34-aval-0-simpflat-38 =r acc-conv-34-simpflat-33
    flat-0-simpflat-40 =i ExceptNotAnError : Error
    flat-0-simpflat-41 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-42 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-43 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-34-aval-0-simpflat-35
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-34-aval-0-simpflat-36 : Array Time
        map_insert_acc_vals-flat-4-simpflat-45 =i conv-34-aval-0-simpflat-37 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-46 =i conv-34-aval-0-simpflat-38 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_loc_vals-flat-8-simpflat-48 =r map_insert_acc_vals-flat-4-simpflat-45
        map_insert_loc_vals-flat-8-simpflat-49 =r map_insert_acc_vals-flat-4-simpflat-46
        map_insert_size-flat-12 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-20 =i False : Bool
        bs_acc_mid-flat-17 =i -1 : Int
        bs_acc_ins-flat-19 =i -1 : Int
        bs_acc_low-flat-25 =i 0 : Int
        bs_acc_high-flat-26 =i sub#
                                 map_insert_size-flat-12
                                 1 : Int
        bs_acc_end-flat-27 =i False : Bool
        
        while (bs_acc_end-flat-27 == False)
        {
            bs_loc_low-flat-23 =r bs_acc_low-flat-25
            bs_loc_high-flat-24 =r bs_acc_high-flat-26
            
            if (gt#
                  bs_loc_low-flat-23
                  bs_loc_high-flat-24)
            {
                bs_acc_end-flat-27 =w True
                bs_acc_ins-flat-19 =w bs_loc_low-flat-23
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-23
                               bs_loc_high-flat-24
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-17 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-21 =r bs_acc_mid-flat-17
                bs_loc_x-flat-22 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-21
                
                if (eq#
                      bs_loc_x-flat-22
                      conv-0-simpflat-129)
                {
                    bs_acc_end-flat-27 =w True
                    bs_acc_found-flat-20 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-22
                          conv-0-simpflat-129)
                    {
                        bs_acc_low-flat-25 =w add#
                                                bs_loc_mid-flat-21
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-26 =w sub#
                                                 bs_loc_mid-flat-21
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-15 =r bs_acc_found-flat-20
        bs_loc_mid-flat-16 =r bs_acc_mid-flat-17
        bs_loc_ins-flat-18 =r bs_acc_ins-flat-19
        
        if (eq#
              bs_loc_found-flat-15
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-16
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-18
        }
        
        flat-101 =r map_insert_acc_bs_found-flat-6
        flat-102 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-101 True)
        {
            simpflat-240 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-48
                             flat-102
            simpflat-242 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-49
                             flat-102
            simpflat-247 = Buf_push#
                             simpflat-240
                             conv-0-simpflat-127
            simpflat-250 = Buf_push#
                             simpflat-242
                             conv-0-simpflat-128
            map_insert_acc_vals-flat-4-simpflat-45 =r map_insert_acc_vals-flat-4-simpflat-45
            map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-45
                                                        flat-102
                                                        simpflat-247
            map_insert_acc_vals-flat-4-simpflat-46 =r map_insert_acc_vals-flat-4-simpflat-46
            map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_immutable#
                                                        map_insert_acc_vals-flat-4-simpflat-46
                                                        flat-102
                                                        simpflat-250
        }
        else
        {
            copy_array-flat-31 =r map_insert_acc_keys-flat-3
            simpflat-4 = Array_length#
                           copy_array-flat-31
            
            if (eq# simpflat-4 0)
            {
                
            }
            else
            {
                simpflat-5 = unsafe_Array_index#
                               copy_array-flat-31
                               0
                map_insert_acc_keys-flat-3 =w Array_put_immutable#
                                                copy_array-flat-31
                                                0
                                                simpflat-5
            }
            
            copy_array-flat-32-simpflat-54 =r map_insert_acc_vals-flat-4-simpflat-45
            copy_array-flat-32-simpflat-55 =r map_insert_acc_vals-flat-4-simpflat-46
            simpflat-6 = Array_length#
                           copy_array-flat-32-simpflat-54
            
            if (eq# simpflat-6 0)
            {
                
            }
            else
            {
                simpflat-262 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-54
                                 0
                simpflat-264 = unsafe_Array_index#
                                 copy_array-flat-32-simpflat-55
                                 0
                map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-54
                                                            0
                                                            simpflat-262
                map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_immutable#
                                                            copy_array-flat-32-simpflat-55
                                                            0
                                                            simpflat-264
            }
            
            
            foreach (for_counter-flat-33 in map_insert_size-flat-12 .. flat-102)
            {
                update_acc-flat-34 =r map_insert_acc_keys-flat-3
                simpflat-8 = sub#
                               for_counter-flat-33
                               1
                simpflat-9 = unsafe_Array_index#
                               map_insert_loc_keys-flat-7
                               simpflat-8
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-34
                                                for_counter-flat-33
                                                simpflat-9
                update_acc-flat-35-simpflat-57 =r map_insert_acc_vals-flat-4-simpflat-45
                update_acc-flat-35-simpflat-58 =r map_insert_acc_vals-flat-4-simpflat-46
                simpflat-274 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-48
                                 simpflat-8
                simpflat-276 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-49
                                 simpflat-8
                map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-57
                                                            for_counter-flat-33
                                                            simpflat-274
                map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-58
                                                            for_counter-flat-33
                                                            simpflat-276
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-102
                                            conv-0-simpflat-129
            simpflat-351 = Buf_make# ()
            simpflat-286 = Buf_push#
                             simpflat-351
                             conv-0-simpflat-127
            simpflat-352 = Buf_make# ()
            simpflat-288 = Buf_push#
                             simpflat-352
                             conv-0-simpflat-128
            map_insert_acc_vals-flat-4-simpflat-45 =r map_insert_acc_vals-flat-4-simpflat-45
            map_insert_acc_vals-flat-4-simpflat-45 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-45
                                                        flat-102
                                                        simpflat-286
            map_insert_acc_vals-flat-4-simpflat-46 =r map_insert_acc_vals-flat-4-simpflat-46
            map_insert_acc_vals-flat-4-simpflat-46 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-46
                                                        flat-102
                                                        simpflat-288
        }
        
        flat-103 =r map_insert_acc_keys-flat-3
        flat-104-simpflat-63 =r map_insert_acc_vals-flat-4-simpflat-45
        flat-104-simpflat-64 =r map_insert_acc_vals-flat-4-simpflat-46
        flat-39-simpflat-66 =i ExceptNotAnError : Error
        flat-39-simpflat-67 =i unsafe_Array_create#
                                 0 : Array Time
        flat-39-simpflat-68 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-39-simpflat-69 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-13 = Array_length#
                        flat-103
        
        if (lt# simpflat-13 conv-3)
        {
            flat-39-simpflat-66 =w ExceptNotAnError
            flat-39-simpflat-67 =w flat-103
            flat-39-simpflat-68 =w flat-104-simpflat-63
            flat-39-simpflat-69 =w flat-104-simpflat-64
        }
        else
        {
            flat-39-simpflat-66 =w ExceptCannotCompute
            flat-39-simpflat-67 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-68 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-69 =w unsafe_Array_create#
                                     0
        }
        
        flat-39-simpflat-71 =r flat-39-simpflat-66
        flat-39-simpflat-72 =r flat-39-simpflat-67
        flat-39-simpflat-73 =r flat-39-simpflat-68
        flat-39-simpflat-74 =r flat-39-simpflat-69
        flat-0-simpflat-40 =w flat-39-simpflat-71
        flat-0-simpflat-41 =w flat-39-simpflat-72
        flat-0-simpflat-42 =w flat-39-simpflat-73
        flat-0-simpflat-43 =w flat-39-simpflat-74
    }
    else
    {
        flat-0-simpflat-40 =w conv-34-aval-0-simpflat-35
        flat-0-simpflat-41 =w unsafe_Array_create#
                                0
        flat-0-simpflat-42 =w unsafe_Array_create#
                                0
        flat-0-simpflat-43 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-76 =r flat-0-simpflat-40
    flat-0-simpflat-77 =r flat-0-simpflat-41
    flat-0-simpflat-78 =r flat-0-simpflat-42
    flat-0-simpflat-79 =r flat-0-simpflat-43
    acc-conv-34-simpflat-30 =w flat-0-simpflat-76
    acc-conv-34-simpflat-31 =w flat-0-simpflat-77
    acc-conv-34-simpflat-32 =w flat-0-simpflat-78
    acc-conv-34-simpflat-33 =w flat-0-simpflat-79
}

conv-34-simpflat-81 =r acc-conv-34-simpflat-30
conv-34-simpflat-82 =r acc-conv-34-simpflat-31
conv-34-simpflat-83 =r acc-conv-34-simpflat-32
conv-34-simpflat-84 =r acc-conv-34-simpflat-33
flat-40-simpflat-86 =i ExceptNotAnError : Error
flat-40-simpflat-87 =i unsafe_Array_create#
                         0 : Array Time
flat-40-simpflat-88 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-34-simpflat-81
      ExceptNotAnError)
{
    flat-48-simpflat-89 =i ExceptNotAnError : Error
    flat-48-simpflat-90 =i unsafe_Array_create#
                             0 : Array Time
    flat-48-simpflat-91 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-49 in 0 .. Array_length#
                                           conv-34-simpflat-82)
    {
        flat-48-simpflat-92 =r flat-48-simpflat-89
        flat-48-simpflat-93 =r flat-48-simpflat-90
        flat-48-simpflat-94 =r flat-48-simpflat-91
        simpflat-310 = unsafe_Array_index#
                         conv-34-simpflat-82
                         for_counter-flat-49
        simpflat-312 = unsafe_Array_index#
                         conv-34-simpflat-83
                         for_counter-flat-49
        simpflat-314 = unsafe_Array_index#
                         conv-34-simpflat-84
                         for_counter-flat-49
        flat-51-simpflat-95 =i ExceptNotAnError : Error
        flat-51-simpflat-96 =i unsafe_Array_create#
                                 0 : Array Time
        flat-51-simpflat-97 =i unsafe_Array_create#
                                 0 : Array Int
        
        if (eq#
              flat-48-simpflat-92
              ExceptNotAnError)
        {
            simpflat-326 = Buf_read#
                             simpflat-312
            simpflat-328 = Buf_read#
                             simpflat-314
            flat-55-simpflat-98 =i ExceptNotAnError : Error
            flat-55-simpflat-99 =i 0 : Int
            
            foreach (for_counter-flat-93 in 0 .. Array_length#
                                                   simpflat-326)
            {
                flat-55-simpflat-100 =r flat-55-simpflat-98
                flat-55-simpflat-101 =r flat-55-simpflat-99
                simpflat-333 = unsafe_Array_index#
                                 simpflat-326
                                 for_counter-flat-93
                simpflat-335 = unsafe_Array_index#
                                 simpflat-328
                                 for_counter-flat-93
                flat-95-simpflat-102 =i ExceptNotAnError : Error
                flat-95-simpflat-103 =i 0 : Int
                
                if (eq#
                      simpflat-333
                      ExceptNotAnError)
                {
                    flat-98-simpflat-104 =i ExceptNotAnError : Error
                    flat-98-simpflat-105 =i 0 : Int
                    
                    if (eq#
                          flat-55-simpflat-100
                          ExceptNotAnError)
                    {
                        simpflat-16 = add#
                                        simpflat-335
                                        flat-55-simpflat-101
                        flat-98-simpflat-104 =w ExceptNotAnError
                        flat-98-simpflat-105 =w simpflat-16
                    }
                    else
                    {
                        flat-98-simpflat-104 =w flat-55-simpflat-100
                        flat-98-simpflat-105 =w 0
                    }
                    
                    flat-98-simpflat-106 =r flat-98-simpflat-104
                    flat-98-simpflat-107 =r flat-98-simpflat-105
                    flat-95-simpflat-102 =w flat-98-simpflat-106
                    flat-95-simpflat-103 =w flat-98-simpflat-107
                }
                else
                {
                    flat-95-simpflat-102 =w simpflat-333
                    flat-95-simpflat-103 =w 0
                }
                
                flat-95-simpflat-108 =r flat-95-simpflat-102
                flat-95-simpflat-109 =r flat-95-simpflat-103
                flat-55-simpflat-98 =w flat-95-simpflat-108
                flat-55-simpflat-99 =w flat-95-simpflat-109
            }
            
            flat-106-simpflat-110 =r flat-55-simpflat-98
            flat-106-simpflat-111 =r flat-55-simpflat-99
            flat-56-simpflat-112 =i ExceptNotAnError : Error
            flat-56-simpflat-113 =i unsafe_Array_create#
                                      0 : Array Time
            flat-56-simpflat-114 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-106-simpflat-110
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-59 =i flat-48-simpflat-93 : Array Time
                map_insert_acc_vals-flat-60 =i flat-48-simpflat-94 : Array Int
                map_insert_acc_bs_found-flat-62 =i False : Bool
                map_insert_acc_bs_index-flat-61 =i -1 : Int
                map_insert_loc_keys-flat-63 =r map_insert_acc_keys-flat-59
                map_insert_loc_vals-flat-64 =r map_insert_acc_vals-flat-60
                map_insert_size-flat-68 = Array_length#
                                            map_insert_loc_keys-flat-63
                bs_acc_found-flat-76 =i False : Bool
                bs_acc_mid-flat-73 =i -1 : Int
                bs_acc_ins-flat-75 =i -1 : Int
                bs_acc_low-flat-81 =i 0 : Int
                bs_acc_high-flat-82 =i sub#
                                         map_insert_size-flat-68
                                         1 : Int
                bs_acc_end-flat-83 =i False : Bool
                
                while (bs_acc_end-flat-83 == False)
                {
                    bs_loc_low-flat-79 =r bs_acc_low-flat-81
                    bs_loc_high-flat-80 =r bs_acc_high-flat-82
                    
                    if (gt#
                          bs_loc_low-flat-79
                          bs_loc_high-flat-80)
                    {
                        bs_acc_end-flat-83 =w True
                        bs_acc_ins-flat-75 =w bs_loc_low-flat-79
                    }
                    else
                    {
                        simpflat-19 = add#
                                        bs_loc_low-flat-79
                                        bs_loc_high-flat-80
                        simpflat-20 = doubleOfInt#
                                        simpflat-19
                        simpflat-21 = div#
                                        simpflat-20
                                        2.0
                        bs_acc_mid-flat-73 =w floor#
                                                simpflat-21
                        bs_loc_mid-flat-77 =r bs_acc_mid-flat-73
                        bs_loc_x-flat-78 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-63
                                             bs_loc_mid-flat-77
                        
                        if (eq#
                              bs_loc_x-flat-78
                              simpflat-310)
                        {
                            bs_acc_end-flat-83 =w True
                            bs_acc_found-flat-76 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-78
                                  simpflat-310)
                            {
                                bs_acc_low-flat-81 =w add#
                                                        bs_loc_mid-flat-77
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-82 =w sub#
                                                         bs_loc_mid-flat-77
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-71 =r bs_acc_found-flat-76
                bs_loc_mid-flat-72 =r bs_acc_mid-flat-73
                bs_loc_ins-flat-74 =r bs_acc_ins-flat-75
                
                if (eq#
                      bs_loc_found-flat-71
                      True)
                {
                    map_insert_acc_bs_found-flat-62 =w True
                    map_insert_acc_bs_index-flat-61 =w bs_loc_mid-flat-72
                }
                else
                {
                    map_insert_acc_bs_found-flat-62 =w False
                    map_insert_acc_bs_index-flat-61 =w bs_loc_ins-flat-74
                }
                
                flat-107 =r map_insert_acc_bs_found-flat-62
                flat-108 =r map_insert_acc_bs_index-flat-61
                
                if (eq# flat-107 True)
                {
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-108
                                                     flat-106-simpflat-111
                }
                else
                {
                    copy_array-flat-86 =r map_insert_acc_keys-flat-59
                    simpflat-22 = Array_length#
                                    copy_array-flat-86
                    
                    if (eq# simpflat-22 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-23 = unsafe_Array_index#
                                        copy_array-flat-86
                                        0
                        map_insert_acc_keys-flat-59 =w Array_put_immutable#
                                                         copy_array-flat-86
                                                         0
                                                         simpflat-23
                    }
                    
                    copy_array-flat-87 =r map_insert_acc_vals-flat-60
                    simpflat-24 = Array_length#
                                    copy_array-flat-87
                    
                    if (eq# simpflat-24 0)
                    {
                        
                    }
                    else
                    {
                        simpflat-25 = unsafe_Array_index#
                                        copy_array-flat-87
                                        0
                        map_insert_acc_vals-flat-60 =w Array_put_immutable#
                                                         copy_array-flat-87
                                                         0
                                                         simpflat-25
                    }
                    
                    
                    foreach (for_counter-flat-88 in map_insert_size-flat-68 .. flat-108)
                    {
                        update_acc-flat-89 =r map_insert_acc_keys-flat-59
                        simpflat-26 = sub#
                                        for_counter-flat-88
                                        1
                        simpflat-27 = unsafe_Array_index#
                                        map_insert_loc_keys-flat-63
                                        simpflat-26
                        map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                         update_acc-flat-89
                                                         for_counter-flat-88
                                                         simpflat-27
                        update_acc-flat-90 =r map_insert_acc_vals-flat-60
                        simpflat-29 = unsafe_Array_index#
                                        map_insert_loc_vals-flat-64
                                        simpflat-26
                        map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                         update_acc-flat-90
                                                         for_counter-flat-88
                                                         simpflat-29
                    }
                    
                    map_insert_acc_keys-flat-59 =r map_insert_acc_keys-flat-59
                    map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-59
                                                     flat-108
                                                     simpflat-310
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-108
                                                     flat-106-simpflat-111
                }
                
                flat-109 =r map_insert_acc_keys-flat-59
                flat-110 =r map_insert_acc_vals-flat-60
                flat-56-simpflat-112 =w ExceptNotAnError
                flat-56-simpflat-113 =w flat-109
                flat-56-simpflat-114 =w flat-110
            }
            else
            {
                flat-56-simpflat-112 =w flat-106-simpflat-110
                flat-56-simpflat-113 =w unsafe_Array_create#
                                          0
                flat-56-simpflat-114 =w unsafe_Array_create#
                                          0
            }
            
            flat-56-simpflat-115 =r flat-56-simpflat-112
            flat-56-simpflat-116 =r flat-56-simpflat-113
            flat-56-simpflat-117 =r flat-56-simpflat-114
            flat-51-simpflat-95 =w flat-56-simpflat-115
            flat-51-simpflat-96 =w flat-56-simpflat-116
            flat-51-simpflat-97 =w flat-56-simpflat-117
        }
        else
        {
            flat-51-simpflat-95 =w flat-48-simpflat-92
            flat-51-simpflat-96 =w unsafe_Array_create#
                                     0
            flat-51-simpflat-97 =w unsafe_Array_create#
                                     0
        }
        
        flat-51-simpflat-118 =r flat-51-simpflat-95
        flat-51-simpflat-119 =r flat-51-simpflat-96
        flat-51-simpflat-120 =r flat-51-simpflat-97
        flat-48-simpflat-89 =w flat-51-simpflat-118
        flat-48-simpflat-90 =w flat-51-simpflat-119
        flat-48-simpflat-91 =w flat-51-simpflat-120
    }
    
    flat-111-simpflat-121 =r flat-48-simpflat-89
    flat-111-simpflat-122 =r flat-48-simpflat-90
    flat-111-simpflat-123 =r flat-48-simpflat-91
    flat-40-simpflat-86 =w flat-111-simpflat-121
    flat-40-simpflat-87 =w flat-111-simpflat-122
    flat-40-simpflat-88 =w flat-111-simpflat-123
}
else
{
    flat-40-simpflat-86 =w conv-34-simpflat-81
    flat-40-simpflat-87 =w unsafe_Array_create#
                             0
    flat-40-simpflat-88 =w unsafe_Array_create#
                             0
}

flat-40-simpflat-124 =r flat-40-simpflat-86
flat-40-simpflat-125 =r flat-40-simpflat-87
flat-40-simpflat-126 =r flat-40-simpflat-88

output repl:output : Sum Error (Map Time Int) =
    flat-40-simpflat-124 : Error
  , flat-40-simpflat-125 : Array Time
  , flat-40-simpflat-126 : Array Int

Core evaluation
---------------

homer|[ (1989-12-17, 100)
      , (1990-01-01, 200)
      , (1994-01-01, 300)
      , (1999-01-01, 400)
      , (2010-01-01, 500)
      ]
marge|[ (1989-12-17, 30) ]

λ λ λ 
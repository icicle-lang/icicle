Queries will no longer be evaluated using the C evaluator.
Snapshot mode activated with a snapshot date of 2017-01-01.
Loaded dictionary with 5 inputs, 0 outputs, 74 functions.
Selected psv file as input: test/cli/repl/data.psv

  ██▓ ▄████▄   ██▓ ▄████▄   ██▓    ▓█████
 ▓██▒▒██▀ ▀█  ▓██▒▒██▀ ▀█  ▓██▒    ▓█   ▀
 ▒██▒▒▓█    ▄ ▒██▒▒▓█    ▄ ▒██░    ▒███
 ░██░▒▓▓▄ ▄██▒░██░▒▓▓▄ ▄██▒▒██░    ▒▓█  ▄
 ░██░▒ ▓███▀ ░░██░▒ ▓███▀ ░░██████▒░▒████▒
 ░▓  ░ ░▒ ▒  ░░▓  ░ ░▒ ▒  ░░ ▒░▓  ░░░ ▒░ ░
  ▒ ░  ░  ▒    ▒ ░  ░  ▒   ░ ░ ▒  ░ ░ ░  ░
  ▒ ░░         ▒ ░░          ░ ░ REPL ░
  ░  ░ ░       ░  ░ ░          ░  ░   ░  ░
     ░            ░
                  ░     :help for help

λ -- Show everything
λ The core will be simplified prior to evaluation.
The flattened simplified avalanche will be shown during evaluation.
λ λ -- A rather complicated feature to convert to Avalanche
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-32-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-32-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-32 : Error
        , conv-0-simpflat-33 : Int
        , conv-0-simpflat-34 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-32
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-33
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-32
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-32
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-32-simpflat-2 =r acc-conv-32-simpflat-2
    acc-conv-32-simpflat-2 =w Buf_push#
                                acc-conv-32-simpflat-2
                                conv-0-simpflat-32
    acc-conv-32-simpflat-3 =r acc-conv-32-simpflat-3
    acc-conv-32-simpflat-3 =w Buf_push#
                                acc-conv-32-simpflat-3
                                conv-0-simpflat-33
}

conv-32-simpflat-16 =r acc-conv-32-simpflat-2
conv-32-simpflat-17 =r acc-conv-32-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
}

flat-10-simpflat-22 =r flat-10-simpflat-20
flat-10-simpflat-23 =r flat-10-simpflat-21
flat-11-simpflat-24 =i ExceptNotAnError : Error
flat-11-simpflat-25 =i 0 : Int
flat-11-simpflat-26 =i unsafe_Array_create#
                         0 : Array Error
flat-11-simpflat-27 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      flat-10-simpflat-22
      ExceptNotAnError)
{
    flat-11-simpflat-24 =w ExceptNotAnError
    flat-11-simpflat-25 =w flat-10-simpflat-23
    flat-11-simpflat-26 =w Buf_read#
                             conv-32-simpflat-16
    flat-11-simpflat-27 =w Buf_read#
                             conv-32-simpflat-17
}
else
{
    flat-11-simpflat-24 =w flat-10-simpflat-22
    flat-11-simpflat-25 =w 0
    flat-11-simpflat-26 =w unsafe_Array_create#
                             0
    flat-11-simpflat-27 =w unsafe_Array_create#
                             0
}

flat-11-simpflat-28 =r flat-11-simpflat-24
flat-11-simpflat-29 =r flat-11-simpflat-25
flat-11-simpflat-30 =r flat-11-simpflat-26
flat-11-simpflat-31 =r flat-11-simpflat-27

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-11-simpflat-28 : Error
  , flat-11-simpflat-29 : Int
  , flat-11-simpflat-30 : Array Error
  , flat-11-simpflat-31 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-32-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-32-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-32 : Error
        , conv-0-simpflat-33 : Int
        , conv-0-simpflat-34 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-32
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-33
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-32
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-32
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-32-simpflat-2 =r acc-conv-32-simpflat-2
    acc-conv-32-simpflat-2 =w Buf_push#
                                acc-conv-32-simpflat-2
                                conv-0-simpflat-32
    acc-conv-32-simpflat-3 =r acc-conv-32-simpflat-3
    acc-conv-32-simpflat-3 =w Buf_push#
                                acc-conv-32-simpflat-3
                                conv-0-simpflat-33
}

conv-32-simpflat-16 =r acc-conv-32-simpflat-2
conv-32-simpflat-17 =r acc-conv-32-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
}

flat-10-simpflat-22 =r flat-10-simpflat-20
flat-10-simpflat-23 =r flat-10-simpflat-21
flat-11-simpflat-24 =i ExceptNotAnError : Error
flat-11-simpflat-25 =i 0 : Int
flat-11-simpflat-26 =i unsafe_Array_create#
                         0 : Array Error
flat-11-simpflat-27 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      flat-10-simpflat-22
      ExceptNotAnError)
{
    flat-11-simpflat-24 =w ExceptNotAnError
    flat-11-simpflat-25 =w flat-10-simpflat-23
    flat-11-simpflat-26 =w Buf_read#
                             conv-32-simpflat-16
    flat-11-simpflat-27 =w Buf_read#
                             conv-32-simpflat-17
}
else
{
    flat-11-simpflat-24 =w flat-10-simpflat-22
    flat-11-simpflat-25 =w 0
    flat-11-simpflat-26 =w unsafe_Array_create#
                             0
    flat-11-simpflat-27 =w unsafe_Array_create#
                             0
}

flat-11-simpflat-28 =r flat-11-simpflat-24
flat-11-simpflat-29 =r flat-11-simpflat-25
flat-11-simpflat-30 =r flat-11-simpflat-26
flat-11-simpflat-31 =r flat-11-simpflat-27

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-11-simpflat-28 : Error
  , flat-11-simpflat-29 : Int
  , flat-11-simpflat-30 : Array Error
  , flat-11-simpflat-31 : Array Int

Core evaluation
---------------

homer|(5, [ 300 , 400 , 500 ])
marge|(1, [ 0 , 10 , 20 ])

λ λ -- Something involves the abstract buffer type
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-34-simpflat-28 =i ExceptNotAnError : Error
acc-conv-34-simpflat-29 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-34-simpflat-30 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-34-simpflat-31 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-128 : Error
        , conv-0-simpflat-129 : Int
        , conv-0-simpflat-130 : Time {
    conv-34-aval-0-simpflat-33 =r acc-conv-34-simpflat-28
    conv-34-aval-0-simpflat-34 =r acc-conv-34-simpflat-29
    conv-34-aval-0-simpflat-35 =r acc-conv-34-simpflat-30
    conv-34-aval-0-simpflat-36 =r acc-conv-34-simpflat-31
    flat-0-simpflat-38 =i ExceptNotAnError : Error
    flat-0-simpflat-39 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-40 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-41 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-34-aval-0-simpflat-33
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-34-aval-0-simpflat-34 : Array Time
        map_insert_acc_vals-flat-4-simpflat-43 =i conv-34-aval-0-simpflat-35 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-44 =i conv-34-aval-0-simpflat-36 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_loc_vals-flat-8-simpflat-46 =r map_insert_acc_vals-flat-4-simpflat-43
        map_insert_loc_vals-flat-8-simpflat-47 =r map_insert_acc_vals-flat-4-simpflat-44
        map_insert_size-flat-12 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-20 =i False : Bool
        bs_acc_mid-flat-17 =i -1 : Int
        bs_acc_ins-flat-19 =i -1 : Int
        bs_acc_low-flat-25 =i 0 : Int
        bs_acc_high-flat-26 =i sub#
                                 map_insert_size-flat-12
                                 1 : Int
        bs_acc_end-flat-27 =i False : Bool
        
        while (bs_acc_end-flat-27 == False)
        {
            bs_loc_low-flat-23 =r bs_acc_low-flat-25
            bs_loc_high-flat-24 =r bs_acc_high-flat-26
            
            if (gt#
                  bs_loc_low-flat-23
                  bs_loc_high-flat-24)
            {
                bs_acc_end-flat-27 =w True
                bs_acc_ins-flat-19 =w bs_loc_low-flat-23
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-23
                               bs_loc_high-flat-24
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-17 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-21 =r bs_acc_mid-flat-17
                bs_loc_x-flat-22 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-21
                
                if (eq#
                      bs_loc_x-flat-22
                      conv-0-simpflat-130)
                {
                    bs_acc_end-flat-27 =w True
                    bs_acc_found-flat-20 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-22
                          conv-0-simpflat-130)
                    {
                        bs_acc_low-flat-25 =w add#
                                                bs_loc_mid-flat-21
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-26 =w sub#
                                                 bs_loc_mid-flat-21
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-15 =r bs_acc_found-flat-20
        bs_loc_mid-flat-16 =r bs_acc_mid-flat-17
        bs_loc_ins-flat-18 =r bs_acc_ins-flat-19
        
        if (eq#
              bs_loc_found-flat-15
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-16
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-18
        }
        
        flat-101 =r map_insert_acc_bs_found-flat-6
        flat-102 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-101 True)
        {
            copy_array-flat-32-simpflat-49 =r map_insert_acc_vals-flat-4-simpflat-43
            copy_array-flat-32-simpflat-50 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-4 = Array_length#
                           copy_array-flat-32-simpflat-49
            
            if (eq# simpflat-4 0)
            {
                
            }
            else
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w copy_array-flat-32-simpflat-49
                map_insert_acc_vals-flat-4-simpflat-44 =w copy_array-flat-32-simpflat-50
            }
            
            simpflat-251 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-46
                             flat-102
            simpflat-253 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-47
                             flat-102
            simpflat-258 = Buf_push#
                             simpflat-251
                             conv-0-simpflat-128
            simpflat-261 = Buf_push#
                             simpflat-253
                             conv-0-simpflat-129
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-102
                                                        simpflat-258
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-102
                                                        simpflat-261
        }
        else
        {
            copy_array-flat-31 =r map_insert_acc_keys-flat-3
            simpflat-5 = Array_length#
                           copy_array-flat-31
            
            if (eq# simpflat-5 0)
            {
                
            }
            else
            {
                map_insert_acc_keys-flat-3 =w copy_array-flat-31
            }
            
            flat-103-simpflat-55 =r map_insert_acc_vals-flat-4-simpflat-43
            flat-103-simpflat-56 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-6 = Array_length#
                           flat-103-simpflat-55
            
            if (eq# simpflat-6 0)
            {
                
            }
            else
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w flat-103-simpflat-55
                map_insert_acc_vals-flat-4-simpflat-44 =w flat-103-simpflat-56
            }
            
            
            foreach (for_counter-flat-33 in map_insert_size-flat-12 .. flat-102)
            {
                update_acc-flat-34 =r map_insert_acc_keys-flat-3
                simpflat-7 = sub#
                               for_counter-flat-33
                               1
                simpflat-8 = unsafe_Array_index#
                               map_insert_loc_keys-flat-7
                               simpflat-7
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-34
                                                for_counter-flat-33
                                                simpflat-8
                update_acc-flat-35-simpflat-58 =r map_insert_acc_vals-flat-4-simpflat-43
                update_acc-flat-35-simpflat-59 =r map_insert_acc_vals-flat-4-simpflat-44
                simpflat-276 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-46
                                 simpflat-7
                simpflat-278 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-47
                                 simpflat-7
                map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-58
                                                            for_counter-flat-33
                                                            simpflat-276
                map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-59
                                                            for_counter-flat-33
                                                            simpflat-278
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-102
                                            conv-0-simpflat-130
            simpflat-353 = Buf_make# ()
            simpflat-288 = Buf_push#
                             simpflat-353
                             conv-0-simpflat-128
            simpflat-354 = Buf_make# ()
            simpflat-290 = Buf_push#
                             simpflat-354
                             conv-0-simpflat-129
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-102
                                                        simpflat-288
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-102
                                                        simpflat-290
        }
        
        flat-104 =r map_insert_acc_keys-flat-3
        flat-105-simpflat-64 =r map_insert_acc_vals-flat-4-simpflat-43
        flat-105-simpflat-65 =r map_insert_acc_vals-flat-4-simpflat-44
        flat-39-simpflat-67 =i ExceptNotAnError : Error
        flat-39-simpflat-68 =i unsafe_Array_create#
                                 0 : Array Time
        flat-39-simpflat-69 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-39-simpflat-70 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-12 = Array_length#
                        flat-104
        
        if (lt# simpflat-12 conv-3)
        {
            flat-39-simpflat-67 =w ExceptNotAnError
            flat-39-simpflat-68 =w flat-104
            flat-39-simpflat-69 =w flat-105-simpflat-64
            flat-39-simpflat-70 =w flat-105-simpflat-65
        }
        else
        {
            flat-39-simpflat-67 =w ExceptCannotCompute
            flat-39-simpflat-68 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-69 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-70 =w unsafe_Array_create#
                                     0
        }
        
        flat-39-simpflat-72 =r flat-39-simpflat-67
        flat-39-simpflat-73 =r flat-39-simpflat-68
        flat-39-simpflat-74 =r flat-39-simpflat-69
        flat-39-simpflat-75 =r flat-39-simpflat-70
        flat-0-simpflat-38 =w flat-39-simpflat-72
        flat-0-simpflat-39 =w flat-39-simpflat-73
        flat-0-simpflat-40 =w flat-39-simpflat-74
        flat-0-simpflat-41 =w flat-39-simpflat-75
    }
    else
    {
        flat-0-simpflat-38 =w conv-34-aval-0-simpflat-33
        flat-0-simpflat-39 =w unsafe_Array_create#
                                0
        flat-0-simpflat-40 =w unsafe_Array_create#
                                0
        flat-0-simpflat-41 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-77 =r flat-0-simpflat-38
    flat-0-simpflat-78 =r flat-0-simpflat-39
    flat-0-simpflat-79 =r flat-0-simpflat-40
    flat-0-simpflat-80 =r flat-0-simpflat-41
    acc-conv-34-simpflat-28 =w flat-0-simpflat-77
    acc-conv-34-simpflat-29 =w flat-0-simpflat-78
    acc-conv-34-simpflat-30 =w flat-0-simpflat-79
    acc-conv-34-simpflat-31 =w flat-0-simpflat-80
}

conv-34-simpflat-82 =r acc-conv-34-simpflat-28
conv-34-simpflat-83 =r acc-conv-34-simpflat-29
conv-34-simpflat-84 =r acc-conv-34-simpflat-30
conv-34-simpflat-85 =r acc-conv-34-simpflat-31
flat-40-simpflat-87 =i ExceptNotAnError : Error
flat-40-simpflat-88 =i unsafe_Array_create#
                         0 : Array Time
flat-40-simpflat-89 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-34-simpflat-82
      ExceptNotAnError)
{
    flat-48-simpflat-90 =i ExceptNotAnError : Error
    flat-48-simpflat-91 =i unsafe_Array_create#
                             0 : Array Time
    flat-48-simpflat-92 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-49 in 0 .. Array_length#
                                           conv-34-simpflat-83)
    {
        flat-48-simpflat-93 =r flat-48-simpflat-90
        flat-48-simpflat-94 =r flat-48-simpflat-91
        flat-48-simpflat-95 =r flat-48-simpflat-92
        simpflat-312 = unsafe_Array_index#
                         conv-34-simpflat-83
                         for_counter-flat-49
        simpflat-314 = unsafe_Array_index#
                         conv-34-simpflat-84
                         for_counter-flat-49
        simpflat-316 = unsafe_Array_index#
                         conv-34-simpflat-85
                         for_counter-flat-49
        flat-51-simpflat-96 =i ExceptNotAnError : Error
        flat-51-simpflat-97 =i unsafe_Array_create#
                                 0 : Array Time
        flat-51-simpflat-98 =i unsafe_Array_create#
                                 0 : Array Int
        
        if (eq#
              flat-48-simpflat-93
              ExceptNotAnError)
        {
            simpflat-328 = Buf_read#
                             simpflat-314
            simpflat-330 = Buf_read#
                             simpflat-316
            flat-55-simpflat-99 =i ExceptNotAnError : Error
            flat-55-simpflat-100 =i 0 : Int
            
            foreach (for_counter-flat-93 in 0 .. Array_length#
                                                   simpflat-328)
            {
                flat-55-simpflat-101 =r flat-55-simpflat-99
                flat-55-simpflat-102 =r flat-55-simpflat-100
                simpflat-335 = unsafe_Array_index#
                                 simpflat-328
                                 for_counter-flat-93
                simpflat-337 = unsafe_Array_index#
                                 simpflat-330
                                 for_counter-flat-93
                flat-95-simpflat-103 =i ExceptNotAnError : Error
                flat-95-simpflat-104 =i 0 : Int
                
                if (eq#
                      simpflat-335
                      ExceptNotAnError)
                {
                    flat-98-simpflat-105 =i ExceptNotAnError : Error
                    flat-98-simpflat-106 =i 0 : Int
                    
                    if (eq#
                          flat-55-simpflat-101
                          ExceptNotAnError)
                    {
                        simpflat-15 = add#
                                        simpflat-337
                                        flat-55-simpflat-102
                        flat-98-simpflat-105 =w ExceptNotAnError
                        flat-98-simpflat-106 =w simpflat-15
                    }
                    else
                    {
                        flat-98-simpflat-105 =w flat-55-simpflat-101
                        flat-98-simpflat-106 =w 0
                    }
                    
                    flat-98-simpflat-107 =r flat-98-simpflat-105
                    flat-98-simpflat-108 =r flat-98-simpflat-106
                    flat-95-simpflat-103 =w flat-98-simpflat-107
                    flat-95-simpflat-104 =w flat-98-simpflat-108
                }
                else
                {
                    flat-95-simpflat-103 =w simpflat-335
                    flat-95-simpflat-104 =w 0
                }
                
                flat-95-simpflat-109 =r flat-95-simpflat-103
                flat-95-simpflat-110 =r flat-95-simpflat-104
                flat-55-simpflat-99 =w flat-95-simpflat-109
                flat-55-simpflat-100 =w flat-95-simpflat-110
            }
            
            flat-107-simpflat-111 =r flat-55-simpflat-99
            flat-107-simpflat-112 =r flat-55-simpflat-100
            flat-56-simpflat-113 =i ExceptNotAnError : Error
            flat-56-simpflat-114 =i unsafe_Array_create#
                                      0 : Array Time
            flat-56-simpflat-115 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-107-simpflat-111
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-59 =i flat-48-simpflat-94 : Array Time
                map_insert_acc_vals-flat-60 =i flat-48-simpflat-95 : Array Int
                map_insert_acc_bs_found-flat-62 =i False : Bool
                map_insert_acc_bs_index-flat-61 =i -1 : Int
                map_insert_loc_keys-flat-63 =r map_insert_acc_keys-flat-59
                map_insert_loc_vals-flat-64 =r map_insert_acc_vals-flat-60
                map_insert_size-flat-68 = Array_length#
                                            map_insert_loc_keys-flat-63
                bs_acc_found-flat-76 =i False : Bool
                bs_acc_mid-flat-73 =i -1 : Int
                bs_acc_ins-flat-75 =i -1 : Int
                bs_acc_low-flat-81 =i 0 : Int
                bs_acc_high-flat-82 =i sub#
                                         map_insert_size-flat-68
                                         1 : Int
                bs_acc_end-flat-83 =i False : Bool
                
                while (bs_acc_end-flat-83 == False)
                {
                    bs_loc_low-flat-79 =r bs_acc_low-flat-81
                    bs_loc_high-flat-80 =r bs_acc_high-flat-82
                    
                    if (gt#
                          bs_loc_low-flat-79
                          bs_loc_high-flat-80)
                    {
                        bs_acc_end-flat-83 =w True
                        bs_acc_ins-flat-75 =w bs_loc_low-flat-79
                    }
                    else
                    {
                        simpflat-18 = add#
                                        bs_loc_low-flat-79
                                        bs_loc_high-flat-80
                        simpflat-19 = doubleOfInt#
                                        simpflat-18
                        simpflat-20 = div#
                                        simpflat-19
                                        2.0
                        bs_acc_mid-flat-73 =w floor#
                                                simpflat-20
                        bs_loc_mid-flat-77 =r bs_acc_mid-flat-73
                        bs_loc_x-flat-78 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-63
                                             bs_loc_mid-flat-77
                        
                        if (eq#
                              bs_loc_x-flat-78
                              simpflat-312)
                        {
                            bs_acc_end-flat-83 =w True
                            bs_acc_found-flat-76 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-78
                                  simpflat-312)
                            {
                                bs_acc_low-flat-81 =w add#
                                                        bs_loc_mid-flat-77
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-82 =w sub#
                                                         bs_loc_mid-flat-77
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-71 =r bs_acc_found-flat-76
                bs_loc_mid-flat-72 =r bs_acc_mid-flat-73
                bs_loc_ins-flat-74 =r bs_acc_ins-flat-75
                
                if (eq#
                      bs_loc_found-flat-71
                      True)
                {
                    map_insert_acc_bs_found-flat-62 =w True
                    map_insert_acc_bs_index-flat-61 =w bs_loc_mid-flat-72
                }
                else
                {
                    map_insert_acc_bs_found-flat-62 =w False
                    map_insert_acc_bs_index-flat-61 =w bs_loc_ins-flat-74
                }
                
                flat-108 =r map_insert_acc_bs_found-flat-62
                flat-109 =r map_insert_acc_bs_index-flat-61
                
                if (eq# flat-108 True)
                {
                    copy_array-flat-87 =r map_insert_acc_vals-flat-60
                    simpflat-21 = Array_length#
                                    copy_array-flat-87
                    
                    if (eq# simpflat-21 0)
                    {
                        
                    }
                    else
                    {
                        map_insert_acc_vals-flat-60 =w Array_copy#
                                                         copy_array-flat-87
                    }
                    
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-112
                }
                else
                {
                    copy_array-flat-86 =r map_insert_acc_keys-flat-59
                    simpflat-22 = Array_length#
                                    copy_array-flat-86
                    
                    if (eq# simpflat-22 0)
                    {
                        
                    }
                    else
                    {
                        map_insert_acc_keys-flat-59 =w copy_array-flat-86
                    }
                    
                    flat-110 =r map_insert_acc_vals-flat-60
                    simpflat-23 = Array_length#
                                    flat-110
                    
                    if (eq# simpflat-23 0)
                    {
                        
                    }
                    else
                    {
                        map_insert_acc_vals-flat-60 =w Array_copy#
                                                         flat-110
                    }
                    
                    
                    foreach (for_counter-flat-88 in map_insert_size-flat-68 .. flat-109)
                    {
                        update_acc-flat-89 =r map_insert_acc_keys-flat-59
                        simpflat-24 = sub#
                                        for_counter-flat-88
                                        1
                        simpflat-25 = unsafe_Array_index#
                                        map_insert_loc_keys-flat-63
                                        simpflat-24
                        map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                         update_acc-flat-89
                                                         for_counter-flat-88
                                                         simpflat-25
                        update_acc-flat-90 =r map_insert_acc_vals-flat-60
                        simpflat-27 = unsafe_Array_index#
                                        map_insert_loc_vals-flat-64
                                        simpflat-24
                        map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                         update_acc-flat-90
                                                         for_counter-flat-88
                                                         simpflat-27
                    }
                    
                    map_insert_acc_keys-flat-59 =r map_insert_acc_keys-flat-59
                    map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-59
                                                     flat-109
                                                     simpflat-312
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-112
                }
                
                flat-111 =r map_insert_acc_keys-flat-59
                flat-112 =r map_insert_acc_vals-flat-60
                flat-56-simpflat-113 =w ExceptNotAnError
                flat-56-simpflat-114 =w flat-111
                flat-56-simpflat-115 =w flat-112
            }
            else
            {
                flat-56-simpflat-113 =w flat-107-simpflat-111
                flat-56-simpflat-114 =w unsafe_Array_create#
                                          0
                flat-56-simpflat-115 =w unsafe_Array_create#
                                          0
            }
            
            flat-56-simpflat-116 =r flat-56-simpflat-113
            flat-56-simpflat-117 =r flat-56-simpflat-114
            flat-56-simpflat-118 =r flat-56-simpflat-115
            flat-51-simpflat-96 =w flat-56-simpflat-116
            flat-51-simpflat-97 =w flat-56-simpflat-117
            flat-51-simpflat-98 =w flat-56-simpflat-118
        }
        else
        {
            flat-51-simpflat-96 =w flat-48-simpflat-93
            flat-51-simpflat-97 =w unsafe_Array_create#
                                     0
            flat-51-simpflat-98 =w unsafe_Array_create#
                                     0
        }
        
        flat-51-simpflat-119 =r flat-51-simpflat-96
        flat-51-simpflat-120 =r flat-51-simpflat-97
        flat-51-simpflat-121 =r flat-51-simpflat-98
        flat-48-simpflat-90 =w flat-51-simpflat-119
        flat-48-simpflat-91 =w flat-51-simpflat-120
        flat-48-simpflat-92 =w flat-51-simpflat-121
    }
    
    flat-113-simpflat-122 =r flat-48-simpflat-90
    flat-113-simpflat-123 =r flat-48-simpflat-91
    flat-113-simpflat-124 =r flat-48-simpflat-92
    flat-40-simpflat-87 =w flat-113-simpflat-122
    flat-40-simpflat-88 =w flat-113-simpflat-123
    flat-40-simpflat-89 =w flat-113-simpflat-124
}
else
{
    flat-40-simpflat-87 =w conv-34-simpflat-82
    flat-40-simpflat-88 =w unsafe_Array_create#
                             0
    flat-40-simpflat-89 =w unsafe_Array_create#
                             0
}

flat-40-simpflat-125 =r flat-40-simpflat-87
flat-40-simpflat-126 =r flat-40-simpflat-88
flat-40-simpflat-127 =r flat-40-simpflat-89

output repl:output : Sum Error (Map Time Int) =
    flat-40-simpflat-125 : Error
  , flat-40-simpflat-126 : Array Time
  , flat-40-simpflat-127 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-34-simpflat-28 =i ExceptNotAnError : Error
acc-conv-34-simpflat-29 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-34-simpflat-30 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-34-simpflat-31 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-128 : Error
        , conv-0-simpflat-129 : Int
        , conv-0-simpflat-130 : Time {
    conv-34-aval-0-simpflat-33 =r acc-conv-34-simpflat-28
    conv-34-aval-0-simpflat-34 =r acc-conv-34-simpflat-29
    conv-34-aval-0-simpflat-35 =r acc-conv-34-simpflat-30
    conv-34-aval-0-simpflat-36 =r acc-conv-34-simpflat-31
    flat-0-simpflat-38 =i ExceptNotAnError : Error
    flat-0-simpflat-39 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-40 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-41 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-34-aval-0-simpflat-33
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-34-aval-0-simpflat-34 : Array Time
        map_insert_acc_vals-flat-4-simpflat-43 =i conv-34-aval-0-simpflat-35 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-44 =i conv-34-aval-0-simpflat-36 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_loc_vals-flat-8-simpflat-46 =r map_insert_acc_vals-flat-4-simpflat-43
        map_insert_loc_vals-flat-8-simpflat-47 =r map_insert_acc_vals-flat-4-simpflat-44
        map_insert_size-flat-12 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-20 =i False : Bool
        bs_acc_mid-flat-17 =i -1 : Int
        bs_acc_ins-flat-19 =i -1 : Int
        bs_acc_low-flat-25 =i 0 : Int
        bs_acc_high-flat-26 =i sub#
                                 map_insert_size-flat-12
                                 1 : Int
        bs_acc_end-flat-27 =i False : Bool
        
        while (bs_acc_end-flat-27 == False)
        {
            bs_loc_low-flat-23 =r bs_acc_low-flat-25
            bs_loc_high-flat-24 =r bs_acc_high-flat-26
            
            if (gt#
                  bs_loc_low-flat-23
                  bs_loc_high-flat-24)
            {
                bs_acc_end-flat-27 =w True
                bs_acc_ins-flat-19 =w bs_loc_low-flat-23
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-23
                               bs_loc_high-flat-24
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-17 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-21 =r bs_acc_mid-flat-17
                bs_loc_x-flat-22 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-21
                
                if (eq#
                      bs_loc_x-flat-22
                      conv-0-simpflat-130)
                {
                    bs_acc_end-flat-27 =w True
                    bs_acc_found-flat-20 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-22
                          conv-0-simpflat-130)
                    {
                        bs_acc_low-flat-25 =w add#
                                                bs_loc_mid-flat-21
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-26 =w sub#
                                                 bs_loc_mid-flat-21
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-15 =r bs_acc_found-flat-20
        bs_loc_mid-flat-16 =r bs_acc_mid-flat-17
        bs_loc_ins-flat-18 =r bs_acc_ins-flat-19
        
        if (eq#
              bs_loc_found-flat-15
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-16
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-18
        }
        
        flat-101 =r map_insert_acc_bs_found-flat-6
        flat-102 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-101 True)
        {
            copy_array-flat-32-simpflat-49 =r map_insert_acc_vals-flat-4-simpflat-43
            copy_array-flat-32-simpflat-50 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-4 = Array_length#
                           copy_array-flat-32-simpflat-49
            
            if (eq# simpflat-4 0)
            {
                
            }
            else
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w copy_array-flat-32-simpflat-49
                map_insert_acc_vals-flat-4-simpflat-44 =w copy_array-flat-32-simpflat-50
            }
            
            simpflat-251 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-46
                             flat-102
            simpflat-253 = unsafe_Array_index#
                             map_insert_loc_vals-flat-8-simpflat-47
                             flat-102
            simpflat-258 = Buf_push#
                             simpflat-251
                             conv-0-simpflat-128
            simpflat-261 = Buf_push#
                             simpflat-253
                             conv-0-simpflat-129
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-102
                                                        simpflat-258
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-102
                                                        simpflat-261
        }
        else
        {
            copy_array-flat-31 =r map_insert_acc_keys-flat-3
            simpflat-5 = Array_length#
                           copy_array-flat-31
            
            if (eq# simpflat-5 0)
            {
                
            }
            else
            {
                map_insert_acc_keys-flat-3 =w copy_array-flat-31
            }
            
            flat-103-simpflat-55 =r map_insert_acc_vals-flat-4-simpflat-43
            flat-103-simpflat-56 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-6 = Array_length#
                           flat-103-simpflat-55
            
            if (eq# simpflat-6 0)
            {
                
            }
            else
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w flat-103-simpflat-55
                map_insert_acc_vals-flat-4-simpflat-44 =w flat-103-simpflat-56
            }
            
            
            foreach (for_counter-flat-33 in map_insert_size-flat-12 .. flat-102)
            {
                update_acc-flat-34 =r map_insert_acc_keys-flat-3
                simpflat-7 = sub#
                               for_counter-flat-33
                               1
                simpflat-8 = unsafe_Array_index#
                               map_insert_loc_keys-flat-7
                               simpflat-7
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-34
                                                for_counter-flat-33
                                                simpflat-8
                update_acc-flat-35-simpflat-58 =r map_insert_acc_vals-flat-4-simpflat-43
                update_acc-flat-35-simpflat-59 =r map_insert_acc_vals-flat-4-simpflat-44
                simpflat-276 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-46
                                 simpflat-7
                simpflat-278 = unsafe_Array_index#
                                 map_insert_loc_vals-flat-8-simpflat-47
                                 simpflat-7
                map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-58
                                                            for_counter-flat-33
                                                            simpflat-276
                map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                            update_acc-flat-35-simpflat-59
                                                            for_counter-flat-33
                                                            simpflat-278
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-102
                                            conv-0-simpflat-130
            simpflat-353 = Buf_make# ()
            simpflat-288 = Buf_push#
                             simpflat-353
                             conv-0-simpflat-128
            simpflat-354 = Buf_make# ()
            simpflat-290 = Buf_push#
                             simpflat-354
                             conv-0-simpflat-129
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-102
                                                        simpflat-288
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-102
                                                        simpflat-290
        }
        
        flat-104 =r map_insert_acc_keys-flat-3
        flat-105-simpflat-64 =r map_insert_acc_vals-flat-4-simpflat-43
        flat-105-simpflat-65 =r map_insert_acc_vals-flat-4-simpflat-44
        flat-39-simpflat-67 =i ExceptNotAnError : Error
        flat-39-simpflat-68 =i unsafe_Array_create#
                                 0 : Array Time
        flat-39-simpflat-69 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-39-simpflat-70 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-12 = Array_length#
                        flat-104
        
        if (lt# simpflat-12 conv-3)
        {
            flat-39-simpflat-67 =w ExceptNotAnError
            flat-39-simpflat-68 =w flat-104
            flat-39-simpflat-69 =w flat-105-simpflat-64
            flat-39-simpflat-70 =w flat-105-simpflat-65
        }
        else
        {
            flat-39-simpflat-67 =w ExceptCannotCompute
            flat-39-simpflat-68 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-69 =w unsafe_Array_create#
                                     0
            flat-39-simpflat-70 =w unsafe_Array_create#
                                     0
        }
        
        flat-39-simpflat-72 =r flat-39-simpflat-67
        flat-39-simpflat-73 =r flat-39-simpflat-68
        flat-39-simpflat-74 =r flat-39-simpflat-69
        flat-39-simpflat-75 =r flat-39-simpflat-70
        flat-0-simpflat-38 =w flat-39-simpflat-72
        flat-0-simpflat-39 =w flat-39-simpflat-73
        flat-0-simpflat-40 =w flat-39-simpflat-74
        flat-0-simpflat-41 =w flat-39-simpflat-75
    }
    else
    {
        flat-0-simpflat-38 =w conv-34-aval-0-simpflat-33
        flat-0-simpflat-39 =w unsafe_Array_create#
                                0
        flat-0-simpflat-40 =w unsafe_Array_create#
                                0
        flat-0-simpflat-41 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-77 =r flat-0-simpflat-38
    flat-0-simpflat-78 =r flat-0-simpflat-39
    flat-0-simpflat-79 =r flat-0-simpflat-40
    flat-0-simpflat-80 =r flat-0-simpflat-41
    acc-conv-34-simpflat-28 =w flat-0-simpflat-77
    acc-conv-34-simpflat-29 =w flat-0-simpflat-78
    acc-conv-34-simpflat-30 =w flat-0-simpflat-79
    acc-conv-34-simpflat-31 =w flat-0-simpflat-80
}

conv-34-simpflat-82 =r acc-conv-34-simpflat-28
conv-34-simpflat-83 =r acc-conv-34-simpflat-29
conv-34-simpflat-84 =r acc-conv-34-simpflat-30
conv-34-simpflat-85 =r acc-conv-34-simpflat-31
flat-40-simpflat-87 =i ExceptNotAnError : Error
flat-40-simpflat-88 =i unsafe_Array_create#
                         0 : Array Time
flat-40-simpflat-89 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-34-simpflat-82
      ExceptNotAnError)
{
    flat-48-simpflat-90 =i ExceptNotAnError : Error
    flat-48-simpflat-91 =i unsafe_Array_create#
                             0 : Array Time
    flat-48-simpflat-92 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-49 in 0 .. Array_length#
                                           conv-34-simpflat-83)
    {
        flat-48-simpflat-93 =r flat-48-simpflat-90
        flat-48-simpflat-94 =r flat-48-simpflat-91
        flat-48-simpflat-95 =r flat-48-simpflat-92
        simpflat-312 = unsafe_Array_index#
                         conv-34-simpflat-83
                         for_counter-flat-49
        simpflat-314 = unsafe_Array_index#
                         conv-34-simpflat-84
                         for_counter-flat-49
        simpflat-316 = unsafe_Array_index#
                         conv-34-simpflat-85
                         for_counter-flat-49
        flat-51-simpflat-96 =i ExceptNotAnError : Error
        flat-51-simpflat-97 =i unsafe_Array_create#
                                 0 : Array Time
        flat-51-simpflat-98 =i unsafe_Array_create#
                                 0 : Array Int
        
        if (eq#
              flat-48-simpflat-93
              ExceptNotAnError)
        {
            simpflat-328 = Buf_read#
                             simpflat-314
            simpflat-330 = Buf_read#
                             simpflat-316
            flat-55-simpflat-99 =i ExceptNotAnError : Error
            flat-55-simpflat-100 =i 0 : Int
            
            foreach (for_counter-flat-93 in 0 .. Array_length#
                                                   simpflat-328)
            {
                flat-55-simpflat-101 =r flat-55-simpflat-99
                flat-55-simpflat-102 =r flat-55-simpflat-100
                simpflat-335 = unsafe_Array_index#
                                 simpflat-328
                                 for_counter-flat-93
                simpflat-337 = unsafe_Array_index#
                                 simpflat-330
                                 for_counter-flat-93
                flat-95-simpflat-103 =i ExceptNotAnError : Error
                flat-95-simpflat-104 =i 0 : Int
                
                if (eq#
                      simpflat-335
                      ExceptNotAnError)
                {
                    flat-98-simpflat-105 =i ExceptNotAnError : Error
                    flat-98-simpflat-106 =i 0 : Int
                    
                    if (eq#
                          flat-55-simpflat-101
                          ExceptNotAnError)
                    {
                        simpflat-15 = add#
                                        simpflat-337
                                        flat-55-simpflat-102
                        flat-98-simpflat-105 =w ExceptNotAnError
                        flat-98-simpflat-106 =w simpflat-15
                    }
                    else
                    {
                        flat-98-simpflat-105 =w flat-55-simpflat-101
                        flat-98-simpflat-106 =w 0
                    }
                    
                    flat-98-simpflat-107 =r flat-98-simpflat-105
                    flat-98-simpflat-108 =r flat-98-simpflat-106
                    flat-95-simpflat-103 =w flat-98-simpflat-107
                    flat-95-simpflat-104 =w flat-98-simpflat-108
                }
                else
                {
                    flat-95-simpflat-103 =w simpflat-335
                    flat-95-simpflat-104 =w 0
                }
                
                flat-95-simpflat-109 =r flat-95-simpflat-103
                flat-95-simpflat-110 =r flat-95-simpflat-104
                flat-55-simpflat-99 =w flat-95-simpflat-109
                flat-55-simpflat-100 =w flat-95-simpflat-110
            }
            
            flat-107-simpflat-111 =r flat-55-simpflat-99
            flat-107-simpflat-112 =r flat-55-simpflat-100
            flat-56-simpflat-113 =i ExceptNotAnError : Error
            flat-56-simpflat-114 =i unsafe_Array_create#
                                      0 : Array Time
            flat-56-simpflat-115 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-107-simpflat-111
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-59 =i flat-48-simpflat-94 : Array Time
                map_insert_acc_vals-flat-60 =i flat-48-simpflat-95 : Array Int
                map_insert_acc_bs_found-flat-62 =i False : Bool
                map_insert_acc_bs_index-flat-61 =i -1 : Int
                map_insert_loc_keys-flat-63 =r map_insert_acc_keys-flat-59
                map_insert_loc_vals-flat-64 =r map_insert_acc_vals-flat-60
                map_insert_size-flat-68 = Array_length#
                                            map_insert_loc_keys-flat-63
                bs_acc_found-flat-76 =i False : Bool
                bs_acc_mid-flat-73 =i -1 : Int
                bs_acc_ins-flat-75 =i -1 : Int
                bs_acc_low-flat-81 =i 0 : Int
                bs_acc_high-flat-82 =i sub#
                                         map_insert_size-flat-68
                                         1 : Int
                bs_acc_end-flat-83 =i False : Bool
                
                while (bs_acc_end-flat-83 == False)
                {
                    bs_loc_low-flat-79 =r bs_acc_low-flat-81
                    bs_loc_high-flat-80 =r bs_acc_high-flat-82
                    
                    if (gt#
                          bs_loc_low-flat-79
                          bs_loc_high-flat-80)
                    {
                        bs_acc_end-flat-83 =w True
                        bs_acc_ins-flat-75 =w bs_loc_low-flat-79
                    }
                    else
                    {
                        simpflat-18 = add#
                                        bs_loc_low-flat-79
                                        bs_loc_high-flat-80
                        simpflat-19 = doubleOfInt#
                                        simpflat-18
                        simpflat-20 = div#
                                        simpflat-19
                                        2.0
                        bs_acc_mid-flat-73 =w floor#
                                                simpflat-20
                        bs_loc_mid-flat-77 =r bs_acc_mid-flat-73
                        bs_loc_x-flat-78 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-63
                                             bs_loc_mid-flat-77
                        
                        if (eq#
                              bs_loc_x-flat-78
                              simpflat-312)
                        {
                            bs_acc_end-flat-83 =w True
                            bs_acc_found-flat-76 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-78
                                  simpflat-312)
                            {
                                bs_acc_low-flat-81 =w add#
                                                        bs_loc_mid-flat-77
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-82 =w sub#
                                                         bs_loc_mid-flat-77
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-71 =r bs_acc_found-flat-76
                bs_loc_mid-flat-72 =r bs_acc_mid-flat-73
                bs_loc_ins-flat-74 =r bs_acc_ins-flat-75
                
                if (eq#
                      bs_loc_found-flat-71
                      True)
                {
                    map_insert_acc_bs_found-flat-62 =w True
                    map_insert_acc_bs_index-flat-61 =w bs_loc_mid-flat-72
                }
                else
                {
                    map_insert_acc_bs_found-flat-62 =w False
                    map_insert_acc_bs_index-flat-61 =w bs_loc_ins-flat-74
                }
                
                flat-108 =r map_insert_acc_bs_found-flat-62
                flat-109 =r map_insert_acc_bs_index-flat-61
                
                if (eq# flat-108 True)
                {
                    copy_array-flat-87 =r map_insert_acc_vals-flat-60
                    simpflat-21 = Array_length#
                                    copy_array-flat-87
                    
                    if (eq# simpflat-21 0)
                    {
                        
                    }
                    else
                    {
                        map_insert_acc_vals-flat-60 =w Array_copy#
                                                         copy_array-flat-87
                    }
                    
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-112
                }
                else
                {
                    copy_array-flat-86 =r map_insert_acc_keys-flat-59
                    simpflat-22 = Array_length#
                                    copy_array-flat-86
                    
                    if (eq# simpflat-22 0)
                    {
                        
                    }
                    else
                    {
                        map_insert_acc_keys-flat-59 =w copy_array-flat-86
                    }
                    
                    flat-110 =r map_insert_acc_vals-flat-60
                    simpflat-23 = Array_length#
                                    flat-110
                    
                    if (eq# simpflat-23 0)
                    {
                        
                    }
                    else
                    {
                        map_insert_acc_vals-flat-60 =w Array_copy#
                                                         flat-110
                    }
                    
                    
                    foreach (for_counter-flat-88 in map_insert_size-flat-68 .. flat-109)
                    {
                        update_acc-flat-89 =r map_insert_acc_keys-flat-59
                        simpflat-24 = sub#
                                        for_counter-flat-88
                                        1
                        simpflat-25 = unsafe_Array_index#
                                        map_insert_loc_keys-flat-63
                                        simpflat-24
                        map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                         update_acc-flat-89
                                                         for_counter-flat-88
                                                         simpflat-25
                        update_acc-flat-90 =r map_insert_acc_vals-flat-60
                        simpflat-27 = unsafe_Array_index#
                                        map_insert_loc_vals-flat-64
                                        simpflat-24
                        map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                         update_acc-flat-90
                                                         for_counter-flat-88
                                                         simpflat-27
                    }
                    
                    map_insert_acc_keys-flat-59 =r map_insert_acc_keys-flat-59
                    map_insert_acc_keys-flat-59 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-59
                                                     flat-109
                                                     simpflat-312
                    map_insert_acc_vals-flat-60 =r map_insert_acc_vals-flat-60
                    map_insert_acc_vals-flat-60 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-60
                                                     flat-109
                                                     flat-107-simpflat-112
                }
                
                flat-111 =r map_insert_acc_keys-flat-59
                flat-112 =r map_insert_acc_vals-flat-60
                flat-56-simpflat-113 =w ExceptNotAnError
                flat-56-simpflat-114 =w flat-111
                flat-56-simpflat-115 =w flat-112
            }
            else
            {
                flat-56-simpflat-113 =w flat-107-simpflat-111
                flat-56-simpflat-114 =w unsafe_Array_create#
                                          0
                flat-56-simpflat-115 =w unsafe_Array_create#
                                          0
            }
            
            flat-56-simpflat-116 =r flat-56-simpflat-113
            flat-56-simpflat-117 =r flat-56-simpflat-114
            flat-56-simpflat-118 =r flat-56-simpflat-115
            flat-51-simpflat-96 =w flat-56-simpflat-116
            flat-51-simpflat-97 =w flat-56-simpflat-117
            flat-51-simpflat-98 =w flat-56-simpflat-118
        }
        else
        {
            flat-51-simpflat-96 =w flat-48-simpflat-93
            flat-51-simpflat-97 =w unsafe_Array_create#
                                     0
            flat-51-simpflat-98 =w unsafe_Array_create#
                                     0
        }
        
        flat-51-simpflat-119 =r flat-51-simpflat-96
        flat-51-simpflat-120 =r flat-51-simpflat-97
        flat-51-simpflat-121 =r flat-51-simpflat-98
        flat-48-simpflat-90 =w flat-51-simpflat-119
        flat-48-simpflat-91 =w flat-51-simpflat-120
        flat-48-simpflat-92 =w flat-51-simpflat-121
    }
    
    flat-113-simpflat-122 =r flat-48-simpflat-90
    flat-113-simpflat-123 =r flat-48-simpflat-91
    flat-113-simpflat-124 =r flat-48-simpflat-92
    flat-40-simpflat-87 =w flat-113-simpflat-122
    flat-40-simpflat-88 =w flat-113-simpflat-123
    flat-40-simpflat-89 =w flat-113-simpflat-124
}
else
{
    flat-40-simpflat-87 =w conv-34-simpflat-82
    flat-40-simpflat-88 =w unsafe_Array_create#
                             0
    flat-40-simpflat-89 =w unsafe_Array_create#
                             0
}

flat-40-simpflat-125 =r flat-40-simpflat-87
flat-40-simpflat-126 =r flat-40-simpflat-88
flat-40-simpflat-127 =r flat-40-simpflat-89

output repl:output : Sum Error (Map Time Int) =
    flat-40-simpflat-125 : Error
  , flat-40-simpflat-126 : Array Time
  , flat-40-simpflat-127 : Array Int

Core evaluation
---------------

homer|[ (1989-12-17, 100)
      , (1990-01-01, 200)
      , (1994-01-01, 300)
      , (1999-01-01, 400)
      , (2010-01-01, 500)
      ]
marge|[ (1989-12-17, 30) ]

λ λ λ 
Queries will no longer be evaluated using the C evaluator.
Snapshot mode activated with a snapshot date of 2017-01-01.
Loaded dictionary with 5 inputs, 0 outputs, 74 functions.
Selected psv file as input: test/cli/repl/data.psv

  ██▓ ▄████▄   ██▓ ▄████▄   ██▓    ▓█████
 ▓██▒▒██▀ ▀█  ▓██▒▒██▀ ▀█  ▓██▒    ▓█   ▀
 ▒██▒▒▓█    ▄ ▒██▒▒▓█    ▄ ▒██░    ▒███
 ░██░▒▓▓▄ ▄██▒░██░▒▓▓▄ ▄██▒▒██░    ▒▓█  ▄
 ░██░▒ ▓███▀ ░░██░▒ ▓███▀ ░░██████▒░▒████▒
 ░▓  ░ ░▒ ▒  ░░▓  ░ ░▒ ▒  ░░ ▒░▓  ░░░ ▒░ ░
  ▒ ░  ░  ▒    ▒ ░  ░  ▒   ░ ░ ▒  ░ ░ ░  ░
  ▒ ░░         ▒ ░░          ░ ░ REPL ░
  ░  ░ ░       ░  ░ ░          ░  ░   ░  ░
     ░            ░
                  ░     :help for help

λ -- Show everything
λ The core will be simplified prior to evaluation.
The flattened simplified avalanche will be shown during evaluation.
λ λ -- A rather complicated feature to convert to Avalanche
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-32-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-32-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-32 : Error
        , conv-0-simpflat-33 : Int
        , conv-0-simpflat-34 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-32
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-33
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-32
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-32
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-32-simpflat-2 =r acc-conv-32-simpflat-2
    acc-conv-32-simpflat-2 =w Buf_push#
                                acc-conv-32-simpflat-2
                                conv-0-simpflat-32
    acc-conv-32-simpflat-3 =r acc-conv-32-simpflat-3
    acc-conv-32-simpflat-3 =w Buf_push#
                                acc-conv-32-simpflat-3
                                conv-0-simpflat-33
}

conv-32-simpflat-16 =r acc-conv-32-simpflat-2
conv-32-simpflat-17 =r acc-conv-32-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
}

flat-10-simpflat-22 =r flat-10-simpflat-20
flat-10-simpflat-23 =r flat-10-simpflat-21
flat-11-simpflat-24 =i ExceptNotAnError : Error
flat-11-simpflat-25 =i 0 : Int
flat-11-simpflat-26 =i unsafe_Array_create#
                         0 : Array Error
flat-11-simpflat-27 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      flat-10-simpflat-22
      ExceptNotAnError)
{
    flat-11-simpflat-24 =w ExceptNotAnError
    flat-11-simpflat-25 =w flat-10-simpflat-23
    flat-11-simpflat-26 =w Buf_read#
                             conv-32-simpflat-16
    flat-11-simpflat-27 =w Buf_read#
                             conv-32-simpflat-17
}
else
{
    flat-11-simpflat-24 =w flat-10-simpflat-22
    flat-11-simpflat-25 =w 0
    flat-11-simpflat-26 =w unsafe_Array_create#
                             0
    flat-11-simpflat-27 =w unsafe_Array_create#
                             0
}

flat-11-simpflat-28 =r flat-11-simpflat-24
flat-11-simpflat-29 =r flat-11-simpflat-25
flat-11-simpflat-30 =r flat-11-simpflat-26
flat-11-simpflat-31 =r flat-11-simpflat-27

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-11-simpflat-28 : Error
  , flat-11-simpflat-29 : Int
  , flat-11-simpflat-30 : Array Error
  , flat-11-simpflat-31 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-c-conv-10-simpflat-0 =i ExceptNotAnError : Error
acc-c-conv-10-simpflat-1 =i 0 : Int
acc-conv-32-simpflat-2 =i Buf_make#
                            () : Buf 3 Error
acc-conv-32-simpflat-3 =i Buf_make#
                            () : Buf 3 Int

for_facts conv-1 : Time
        , conv-0-simpflat-32 : Error
        , conv-0-simpflat-33 : Int
        , conv-0-simpflat-34 : Time {
    flat-0 =i False : Bool
    
    if (eq#
          conv-0-simpflat-32
          ExceptNotAnError)
    {
        flat-0 =w gt#
                    conv-0-simpflat-33
                    10
    }
    else
    {
        flat-0 =w True
    }
    
    flat-0 =r flat-0
    
    if (flat-0)
    {
        c-conv-10-aval-0-simpflat-4 =r acc-c-conv-10-simpflat-0
        c-conv-10-aval-0-simpflat-5 =r acc-c-conv-10-simpflat-1
        flat-1-simpflat-6 =i ExceptNotAnError : Error
        flat-1-simpflat-7 =i 0 : Int
        
        if (eq#
              conv-0-simpflat-32
              ExceptNotAnError)
        {
            flat-4-simpflat-8 =i ExceptNotAnError : Error
            flat-4-simpflat-9 =i 0 : Int
            
            if (eq#
                  c-conv-10-aval-0-simpflat-4
                  ExceptNotAnError)
            {
                reify-9-conv-17 = add#
                                    c-conv-10-aval-0-simpflat-5
                                    1
                flat-4-simpflat-8 =w ExceptNotAnError
                flat-4-simpflat-9 =w reify-9-conv-17
            }
            else
            {
                flat-4-simpflat-8 =w c-conv-10-aval-0-simpflat-4
                flat-4-simpflat-9 =w 0
            }
            
            flat-4-simpflat-10 =r flat-4-simpflat-8
            flat-4-simpflat-11 =r flat-4-simpflat-9
            flat-1-simpflat-6 =w flat-4-simpflat-10
            flat-1-simpflat-7 =w flat-4-simpflat-11
        }
        else
        {
            flat-1-simpflat-6 =w conv-0-simpflat-32
            flat-1-simpflat-7 =w 0
        }
        
        flat-1-simpflat-12 =r flat-1-simpflat-6
        flat-1-simpflat-13 =r flat-1-simpflat-7
        acc-c-conv-10-simpflat-0 =w flat-1-simpflat-12
        acc-c-conv-10-simpflat-1 =w flat-1-simpflat-13
    }
    
    acc-conv-32-simpflat-2 =r acc-conv-32-simpflat-2
    acc-conv-32-simpflat-2 =w Buf_push#
                                acc-conv-32-simpflat-2
                                conv-0-simpflat-32
    acc-conv-32-simpflat-3 =r acc-conv-32-simpflat-3
    acc-conv-32-simpflat-3 =w Buf_push#
                                acc-conv-32-simpflat-3
                                conv-0-simpflat-33
}

conv-32-simpflat-16 =r acc-conv-32-simpflat-2
conv-32-simpflat-17 =r acc-conv-32-simpflat-3
c-conv-10-simpflat-18 =r acc-c-conv-10-simpflat-0
c-conv-10-simpflat-19 =r acc-c-conv-10-simpflat-1
flat-10-simpflat-20 =i ExceptNotAnError : Error
flat-10-simpflat-21 =i 0 : Int

if (eq#
      c-conv-10-simpflat-18
      ExceptNotAnError)
{
    flat-10-simpflat-20 =w ExceptNotAnError
    flat-10-simpflat-21 =w c-conv-10-simpflat-19
}
else
{
    flat-10-simpflat-20 =w c-conv-10-simpflat-18
    flat-10-simpflat-21 =w 0
}

flat-10-simpflat-22 =r flat-10-simpflat-20
flat-10-simpflat-23 =r flat-10-simpflat-21
flat-11-simpflat-24 =i ExceptNotAnError : Error
flat-11-simpflat-25 =i 0 : Int
flat-11-simpflat-26 =i unsafe_Array_create#
                         0 : Array Error
flat-11-simpflat-27 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      flat-10-simpflat-22
      ExceptNotAnError)
{
    flat-11-simpflat-24 =w ExceptNotAnError
    flat-11-simpflat-25 =w flat-10-simpflat-23
    flat-11-simpflat-26 =w Buf_read#
                             conv-32-simpflat-16
    flat-11-simpflat-27 =w Buf_read#
                             conv-32-simpflat-17
}
else
{
    flat-11-simpflat-24 =w flat-10-simpflat-22
    flat-11-simpflat-25 =w 0
    flat-11-simpflat-26 =w unsafe_Array_create#
                             0
    flat-11-simpflat-27 =w unsafe_Array_create#
                             0
}

flat-11-simpflat-28 =r flat-11-simpflat-24
flat-11-simpflat-29 =r flat-11-simpflat-25
flat-11-simpflat-30 =r flat-11-simpflat-26
flat-11-simpflat-31 =r flat-11-simpflat-27

output repl:output : Sum Error (Int, Array (Sum Error Int)) =
    flat-11-simpflat-28 : Error
  , flat-11-simpflat-29 : Int
  , flat-11-simpflat-30 : Array Error
  , flat-11-simpflat-31 : Array Int

Core evaluation
---------------

homer|(5, [ 300 , 400 , 500 ])
marge|(1, [ 0 , 10 , 20 ])

λ λ -- Something involves the abstract buffer type
λ Flattened (simplified), not typechecked
---------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-35-simpflat-28 =i ExceptNotAnError : Error
acc-conv-35-simpflat-29 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-35-simpflat-30 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-35-simpflat-31 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-134 : Error
        , conv-0-simpflat-135 : Int
        , conv-0-simpflat-136 : Time {
    conv-35-aval-0-simpflat-33 =r acc-conv-35-simpflat-28
    conv-35-aval-0-simpflat-34 =r acc-conv-35-simpflat-29
    conv-35-aval-0-simpflat-35 =r acc-conv-35-simpflat-30
    conv-35-aval-0-simpflat-36 =r acc-conv-35-simpflat-31
    flat-0-simpflat-38 =i ExceptNotAnError : Error
    flat-0-simpflat-39 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-40 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-41 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-35-aval-0-simpflat-33
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-35-aval-0-simpflat-34 : Array Time
        map_insert_acc_vals-flat-4-simpflat-43 =i conv-35-aval-0-simpflat-35 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-44 =i conv-35-aval-0-simpflat-36 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_size-flat-14 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-22 =i False : Bool
        bs_acc_mid-flat-19 =i -1 : Int
        bs_acc_ins-flat-21 =i -1 : Int
        bs_acc_low-flat-27 =i 0 : Int
        bs_acc_high-flat-28 =i sub#
                                 map_insert_size-flat-14
                                 1 : Int
        bs_acc_end-flat-29 =i False : Bool
        
        while (bs_acc_end-flat-29 == False)
        {
            bs_loc_low-flat-25 =r bs_acc_low-flat-27
            bs_loc_high-flat-26 =r bs_acc_high-flat-28
            
            if (gt#
                  bs_loc_low-flat-25
                  bs_loc_high-flat-26)
            {
                bs_acc_end-flat-29 =w True
                bs_acc_ins-flat-21 =w bs_loc_low-flat-25
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-25
                               bs_loc_high-flat-26
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-19 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-23 =r bs_acc_mid-flat-19
                bs_loc_x-flat-24 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-23
                
                if (eq#
                      bs_loc_x-flat-24
                      conv-0-simpflat-136)
                {
                    bs_acc_end-flat-29 =w True
                    bs_acc_found-flat-22 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-24
                          conv-0-simpflat-136)
                    {
                        bs_acc_low-flat-27 =w add#
                                                bs_loc_mid-flat-23
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-28 =w sub#
                                                 bs_loc_mid-flat-23
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-17 =r bs_acc_found-flat-22
        bs_loc_mid-flat-18 =r bs_acc_mid-flat-19
        bs_loc_ins-flat-20 =r bs_acc_ins-flat-21
        
        if (eq#
              bs_loc_found-flat-17
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-18
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-20
        }
        
        flat-105 =r map_insert_acc_bs_found-flat-6
        flat-106 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-105 True)
        {
            copy_array-flat-34-simpflat-49 =r map_insert_acc_vals-flat-4-simpflat-43
            copy_array-flat-34-simpflat-50 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-4 = Array_length#
                           copy_array-flat-34-simpflat-49
            
            if (ne# simpflat-4 0)
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w copy_array-flat-34-simpflat-49
                map_insert_acc_vals-flat-4-simpflat-44 =w copy_array-flat-34-simpflat-50
            }
            
            map_insert_cpy_vals-flat-10-simpflat-52 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_cpy_vals-flat-10-simpflat-53 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-257 = unsafe_Array_index#
                             map_insert_cpy_vals-flat-10-simpflat-52
                             flat-106
            simpflat-259 = unsafe_Array_index#
                             map_insert_cpy_vals-flat-10-simpflat-53
                             flat-106
            simpflat-264 = Buf_push#
                             simpflat-257
                             conv-0-simpflat-134
            simpflat-267 = Buf_push#
                             simpflat-259
                             conv-0-simpflat-135
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-106
                                                        simpflat-264
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-106
                                                        simpflat-267
        }
        else
        {
            copy_array-flat-33 =r map_insert_acc_keys-flat-3
            simpflat-5 = Array_length#
                           copy_array-flat-33
            
            if (ne# simpflat-5 0)
            {
                map_insert_acc_keys-flat-3 =w copy_array-flat-33
            }
            
            flat-107-simpflat-58 =r map_insert_acc_vals-flat-4-simpflat-43
            flat-107-simpflat-59 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-6 = Array_length#
                           flat-107-simpflat-58
            
            if (ne# simpflat-6 0)
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w flat-107-simpflat-58
                map_insert_acc_vals-flat-4-simpflat-44 =w flat-107-simpflat-59
            }
            
            map_insert_cpy_keys-flat-9 =r map_insert_acc_keys-flat-3
            flat-108-simpflat-61 =r map_insert_acc_vals-flat-4-simpflat-43
            flat-108-simpflat-62 =r map_insert_acc_vals-flat-4-simpflat-44
            
            foreach (for_counter-flat-35 in map_insert_size-flat-14 .. flat-106)
            {
                update_acc-flat-36 =r map_insert_acc_keys-flat-3
                simpflat-7 = sub#
                               for_counter-flat-35
                               1
                simpflat-8 = unsafe_Array_index#
                               map_insert_cpy_keys-flat-9
                               simpflat-7
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-36
                                                for_counter-flat-35
                                                simpflat-8
                update_acc-flat-37-simpflat-64 =r map_insert_acc_vals-flat-4-simpflat-43
                update_acc-flat-37-simpflat-65 =r map_insert_acc_vals-flat-4-simpflat-44
                simpflat-282 = unsafe_Array_index#
                                 flat-108-simpflat-61
                                 simpflat-7
                simpflat-284 = unsafe_Array_index#
                                 flat-108-simpflat-62
                                 simpflat-7
                map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                            update_acc-flat-37-simpflat-64
                                                            for_counter-flat-35
                                                            simpflat-282
                map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                            update_acc-flat-37-simpflat-65
                                                            for_counter-flat-35
                                                            simpflat-284
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-106
                                            conv-0-simpflat-136
            simpflat-359 = Buf_make# ()
            simpflat-294 = Buf_push#
                             simpflat-359
                             conv-0-simpflat-134
            simpflat-360 = Buf_make# ()
            simpflat-296 = Buf_push#
                             simpflat-360
                             conv-0-simpflat-135
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-106
                                                        simpflat-294
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-106
                                                        simpflat-296
        }
        
        flat-109 =r map_insert_acc_keys-flat-3
        flat-110-simpflat-70 =r map_insert_acc_vals-flat-4-simpflat-43
        flat-110-simpflat-71 =r map_insert_acc_vals-flat-4-simpflat-44
        flat-41-simpflat-73 =i ExceptNotAnError : Error
        flat-41-simpflat-74 =i unsafe_Array_create#
                                 0 : Array Time
        flat-41-simpflat-75 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-41-simpflat-76 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-12 = Array_length#
                        flat-109
        
        if (lt# simpflat-12 conv-3)
        {
            flat-41-simpflat-73 =w ExceptNotAnError
            flat-41-simpflat-74 =w flat-109
            flat-41-simpflat-75 =w flat-110-simpflat-70
            flat-41-simpflat-76 =w flat-110-simpflat-71
        }
        else
        {
            flat-41-simpflat-73 =w ExceptCannotCompute
            flat-41-simpflat-74 =w unsafe_Array_create#
                                     0
            flat-41-simpflat-75 =w unsafe_Array_create#
                                     0
            flat-41-simpflat-76 =w unsafe_Array_create#
                                     0
        }
        
        flat-41-simpflat-78 =r flat-41-simpflat-73
        flat-41-simpflat-79 =r flat-41-simpflat-74
        flat-41-simpflat-80 =r flat-41-simpflat-75
        flat-41-simpflat-81 =r flat-41-simpflat-76
        flat-0-simpflat-38 =w flat-41-simpflat-78
        flat-0-simpflat-39 =w flat-41-simpflat-79
        flat-0-simpflat-40 =w flat-41-simpflat-80
        flat-0-simpflat-41 =w flat-41-simpflat-81
    }
    else
    {
        flat-0-simpflat-38 =w conv-35-aval-0-simpflat-33
        flat-0-simpflat-39 =w unsafe_Array_create#
                                0
        flat-0-simpflat-40 =w unsafe_Array_create#
                                0
        flat-0-simpflat-41 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-83 =r flat-0-simpflat-38
    flat-0-simpflat-84 =r flat-0-simpflat-39
    flat-0-simpflat-85 =r flat-0-simpflat-40
    flat-0-simpflat-86 =r flat-0-simpflat-41
    acc-conv-35-simpflat-28 =w flat-0-simpflat-83
    acc-conv-35-simpflat-29 =w flat-0-simpflat-84
    acc-conv-35-simpflat-30 =w flat-0-simpflat-85
    acc-conv-35-simpflat-31 =w flat-0-simpflat-86
}

conv-35-simpflat-88 =r acc-conv-35-simpflat-28
conv-35-simpflat-89 =r acc-conv-35-simpflat-29
conv-35-simpflat-90 =r acc-conv-35-simpflat-30
conv-35-simpflat-91 =r acc-conv-35-simpflat-31
flat-42-simpflat-93 =i ExceptNotAnError : Error
flat-42-simpflat-94 =i unsafe_Array_create#
                         0 : Array Time
flat-42-simpflat-95 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-35-simpflat-88
      ExceptNotAnError)
{
    flat-50-simpflat-96 =i ExceptNotAnError : Error
    flat-50-simpflat-97 =i unsafe_Array_create#
                             0 : Array Time
    flat-50-simpflat-98 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-51 in 0 .. Array_length#
                                           conv-35-simpflat-89)
    {
        flat-50-simpflat-99 =r flat-50-simpflat-96
        flat-50-simpflat-100 =r flat-50-simpflat-97
        flat-50-simpflat-101 =r flat-50-simpflat-98
        simpflat-318 = unsafe_Array_index#
                         conv-35-simpflat-89
                         for_counter-flat-51
        simpflat-320 = unsafe_Array_index#
                         conv-35-simpflat-90
                         for_counter-flat-51
        simpflat-322 = unsafe_Array_index#
                         conv-35-simpflat-91
                         for_counter-flat-51
        flat-53-simpflat-102 =i ExceptNotAnError : Error
        flat-53-simpflat-103 =i unsafe_Array_create#
                                  0 : Array Time
        flat-53-simpflat-104 =i unsafe_Array_create#
                                  0 : Array Int
        
        if (eq#
              flat-50-simpflat-99
              ExceptNotAnError)
        {
            simpflat-334 = Buf_read#
                             simpflat-320
            simpflat-336 = Buf_read#
                             simpflat-322
            flat-57-simpflat-105 =i ExceptNotAnError : Error
            flat-57-simpflat-106 =i 0 : Int
            
            foreach (for_counter-flat-97 in 0 .. Array_length#
                                                   simpflat-334)
            {
                flat-57-simpflat-107 =r flat-57-simpflat-105
                flat-57-simpflat-108 =r flat-57-simpflat-106
                simpflat-341 = unsafe_Array_index#
                                 simpflat-334
                                 for_counter-flat-97
                simpflat-343 = unsafe_Array_index#
                                 simpflat-336
                                 for_counter-flat-97
                flat-99-simpflat-109 =i ExceptNotAnError : Error
                flat-99-simpflat-110 =i 0 : Int
                
                if (eq#
                      simpflat-341
                      ExceptNotAnError)
                {
                    flat-102-simpflat-111 =i ExceptNotAnError : Error
                    flat-102-simpflat-112 =i 0 : Int
                    
                    if (eq#
                          flat-57-simpflat-107
                          ExceptNotAnError)
                    {
                        simpflat-15 = add#
                                        simpflat-343
                                        flat-57-simpflat-108
                        flat-102-simpflat-111 =w ExceptNotAnError
                        flat-102-simpflat-112 =w simpflat-15
                    }
                    else
                    {
                        flat-102-simpflat-111 =w flat-57-simpflat-107
                        flat-102-simpflat-112 =w 0
                    }
                    
                    flat-102-simpflat-113 =r flat-102-simpflat-111
                    flat-102-simpflat-114 =r flat-102-simpflat-112
                    flat-99-simpflat-109 =w flat-102-simpflat-113
                    flat-99-simpflat-110 =w flat-102-simpflat-114
                }
                else
                {
                    flat-99-simpflat-109 =w simpflat-341
                    flat-99-simpflat-110 =w 0
                }
                
                flat-99-simpflat-115 =r flat-99-simpflat-109
                flat-99-simpflat-116 =r flat-99-simpflat-110
                flat-57-simpflat-105 =w flat-99-simpflat-115
                flat-57-simpflat-106 =w flat-99-simpflat-116
            }
            
            flat-112-simpflat-117 =r flat-57-simpflat-105
            flat-112-simpflat-118 =r flat-57-simpflat-106
            flat-58-simpflat-119 =i ExceptNotAnError : Error
            flat-58-simpflat-120 =i unsafe_Array_create#
                                      0 : Array Time
            flat-58-simpflat-121 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-112-simpflat-117
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-61 =i flat-50-simpflat-100 : Array Time
                map_insert_acc_vals-flat-62 =i flat-50-simpflat-101 : Array Int
                map_insert_acc_bs_found-flat-64 =i False : Bool
                map_insert_acc_bs_index-flat-63 =i -1 : Int
                map_insert_loc_keys-flat-65 =r map_insert_acc_keys-flat-61
                map_insert_size-flat-72 = Array_length#
                                            map_insert_loc_keys-flat-65
                bs_acc_found-flat-80 =i False : Bool
                bs_acc_mid-flat-77 =i -1 : Int
                bs_acc_ins-flat-79 =i -1 : Int
                bs_acc_low-flat-85 =i 0 : Int
                bs_acc_high-flat-86 =i sub#
                                         map_insert_size-flat-72
                                         1 : Int
                bs_acc_end-flat-87 =i False : Bool
                
                while (bs_acc_end-flat-87 == False)
                {
                    bs_loc_low-flat-83 =r bs_acc_low-flat-85
                    bs_loc_high-flat-84 =r bs_acc_high-flat-86
                    
                    if (gt#
                          bs_loc_low-flat-83
                          bs_loc_high-flat-84)
                    {
                        bs_acc_end-flat-87 =w True
                        bs_acc_ins-flat-79 =w bs_loc_low-flat-83
                    }
                    else
                    {
                        simpflat-18 = add#
                                        bs_loc_low-flat-83
                                        bs_loc_high-flat-84
                        simpflat-19 = doubleOfInt#
                                        simpflat-18
                        simpflat-20 = div#
                                        simpflat-19
                                        2.0
                        bs_acc_mid-flat-77 =w floor#
                                                simpflat-20
                        bs_loc_mid-flat-81 =r bs_acc_mid-flat-77
                        bs_loc_x-flat-82 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-65
                                             bs_loc_mid-flat-81
                        
                        if (eq#
                              bs_loc_x-flat-82
                              simpflat-318)
                        {
                            bs_acc_end-flat-87 =w True
                            bs_acc_found-flat-80 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-82
                                  simpflat-318)
                            {
                                bs_acc_low-flat-85 =w add#
                                                        bs_loc_mid-flat-81
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-86 =w sub#
                                                         bs_loc_mid-flat-81
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-75 =r bs_acc_found-flat-80
                bs_loc_mid-flat-76 =r bs_acc_mid-flat-77
                bs_loc_ins-flat-78 =r bs_acc_ins-flat-79
                
                if (eq#
                      bs_loc_found-flat-75
                      True)
                {
                    map_insert_acc_bs_found-flat-64 =w True
                    map_insert_acc_bs_index-flat-63 =w bs_loc_mid-flat-76
                }
                else
                {
                    map_insert_acc_bs_found-flat-64 =w False
                    map_insert_acc_bs_index-flat-63 =w bs_loc_ins-flat-78
                }
                
                flat-113 =r map_insert_acc_bs_found-flat-64
                flat-114 =r map_insert_acc_bs_index-flat-63
                
                if (eq# flat-113 True)
                {
                    copy_array-flat-91 =r map_insert_acc_vals-flat-62
                    simpflat-21 = Array_length#
                                    copy_array-flat-91
                    
                    if (ne# simpflat-21 0)
                    {
                        map_insert_acc_vals-flat-62 =w copy_array-flat-91
                    }
                    
                    map_insert_acc_vals-flat-62 =r map_insert_acc_vals-flat-62
                    map_insert_acc_vals-flat-62 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-62
                                                     flat-114
                                                     flat-112-simpflat-118
                }
                else
                {
                    copy_array-flat-90 =r map_insert_acc_keys-flat-61
                    simpflat-22 = Array_length#
                                    copy_array-flat-90
                    
                    if (ne# simpflat-22 0)
                    {
                        map_insert_acc_keys-flat-61 =w copy_array-flat-90
                    }
                    
                    flat-115 =r map_insert_acc_vals-flat-62
                    simpflat-23 = Array_length#
                                    flat-115
                    
                    if (ne# simpflat-23 0)
                    {
                        map_insert_acc_vals-flat-62 =w flat-115
                    }
                    
                    map_insert_cpy_keys-flat-67 =r map_insert_acc_keys-flat-61
                    flat-116 =r map_insert_acc_vals-flat-62
                    
                    foreach (for_counter-flat-92 in map_insert_size-flat-72 .. flat-114)
                    {
                        update_acc-flat-93 =r map_insert_acc_keys-flat-61
                        simpflat-24 = sub#
                                        for_counter-flat-92
                                        1
                        simpflat-25 = unsafe_Array_index#
                                        map_insert_cpy_keys-flat-67
                                        simpflat-24
                        map_insert_acc_keys-flat-61 =w Array_put_mutable#
                                                         update_acc-flat-93
                                                         for_counter-flat-92
                                                         simpflat-25
                        update_acc-flat-94 =r map_insert_acc_vals-flat-62
                        simpflat-27 = unsafe_Array_index#
                                        flat-116
                                        simpflat-24
                        map_insert_acc_vals-flat-62 =w Array_put_mutable#
                                                         update_acc-flat-94
                                                         for_counter-flat-92
                                                         simpflat-27
                    }
                    
                    map_insert_acc_keys-flat-61 =r map_insert_acc_keys-flat-61
                    map_insert_acc_keys-flat-61 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-61
                                                     flat-114
                                                     simpflat-318
                    map_insert_acc_vals-flat-62 =r map_insert_acc_vals-flat-62
                    map_insert_acc_vals-flat-62 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-62
                                                     flat-114
                                                     flat-112-simpflat-118
                }
                
                flat-117 =r map_insert_acc_keys-flat-61
                flat-118 =r map_insert_acc_vals-flat-62
                flat-58-simpflat-119 =w ExceptNotAnError
                flat-58-simpflat-120 =w flat-117
                flat-58-simpflat-121 =w flat-118
            }
            else
            {
                flat-58-simpflat-119 =w flat-112-simpflat-117
                flat-58-simpflat-120 =w unsafe_Array_create#
                                          0
                flat-58-simpflat-121 =w unsafe_Array_create#
                                          0
            }
            
            flat-58-simpflat-122 =r flat-58-simpflat-119
            flat-58-simpflat-123 =r flat-58-simpflat-120
            flat-58-simpflat-124 =r flat-58-simpflat-121
            flat-53-simpflat-102 =w flat-58-simpflat-122
            flat-53-simpflat-103 =w flat-58-simpflat-123
            flat-53-simpflat-104 =w flat-58-simpflat-124
        }
        else
        {
            flat-53-simpflat-102 =w flat-50-simpflat-99
            flat-53-simpflat-103 =w unsafe_Array_create#
                                      0
            flat-53-simpflat-104 =w unsafe_Array_create#
                                      0
        }
        
        flat-53-simpflat-125 =r flat-53-simpflat-102
        flat-53-simpflat-126 =r flat-53-simpflat-103
        flat-53-simpflat-127 =r flat-53-simpflat-104
        flat-50-simpflat-96 =w flat-53-simpflat-125
        flat-50-simpflat-97 =w flat-53-simpflat-126
        flat-50-simpflat-98 =w flat-53-simpflat-127
    }
    
    flat-119-simpflat-128 =r flat-50-simpflat-96
    flat-119-simpflat-129 =r flat-50-simpflat-97
    flat-119-simpflat-130 =r flat-50-simpflat-98
    flat-42-simpflat-93 =w flat-119-simpflat-128
    flat-42-simpflat-94 =w flat-119-simpflat-129
    flat-42-simpflat-95 =w flat-119-simpflat-130
}
else
{
    flat-42-simpflat-93 =w conv-35-simpflat-88
    flat-42-simpflat-94 =w unsafe_Array_create#
                             0
    flat-42-simpflat-95 =w unsafe_Array_create#
                             0
}

flat-42-simpflat-131 =r flat-42-simpflat-93
flat-42-simpflat-132 =r flat-42-simpflat-94
flat-42-simpflat-133 =r flat-42-simpflat-95

output repl:output : Sum Error (Map Time Int) =
    flat-42-simpflat-131 : Error
  , flat-42-simpflat-132 : Array Time
  , flat-42-simpflat-133 : Array Int

Flattened Avalanche (simplified), typechecked
---------------------------------------------

conv-2 : Time =
  TIME
conv-3 : Int =
  MAX_MAP_SIZE

acc-conv-35-simpflat-28 =i ExceptNotAnError : Error
acc-conv-35-simpflat-29 =i unsafe_Array_create#
                             0 : Array Time
acc-conv-35-simpflat-30 =i unsafe_Array_create#
                             0 : Array (Buf 2 Error)
acc-conv-35-simpflat-31 =i unsafe_Array_create#
                             0 : Array (Buf 2 Int)

for_facts conv-1 : Time
        , conv-0-simpflat-134 : Error
        , conv-0-simpflat-135 : Int
        , conv-0-simpflat-136 : Time {
    conv-35-aval-0-simpflat-33 =r acc-conv-35-simpflat-28
    conv-35-aval-0-simpflat-34 =r acc-conv-35-simpflat-29
    conv-35-aval-0-simpflat-35 =r acc-conv-35-simpflat-30
    conv-35-aval-0-simpflat-36 =r acc-conv-35-simpflat-31
    flat-0-simpflat-38 =i ExceptNotAnError : Error
    flat-0-simpflat-39 =i unsafe_Array_create#
                            0 : Array Time
    flat-0-simpflat-40 =i unsafe_Array_create#
                            0 : Array (Buf 2 Error)
    flat-0-simpflat-41 =i unsafe_Array_create#
                            0 : Array (Buf 2 Int)
    
    if (eq#
          conv-35-aval-0-simpflat-33
          ExceptNotAnError)
    {
        map_insert_acc_keys-flat-3 =i conv-35-aval-0-simpflat-34 : Array Time
        map_insert_acc_vals-flat-4-simpflat-43 =i conv-35-aval-0-simpflat-35 : Array (Buf 2 Error)
        map_insert_acc_vals-flat-4-simpflat-44 =i conv-35-aval-0-simpflat-36 : Array (Buf 2 Int)
        map_insert_acc_bs_found-flat-6 =i False : Bool
        map_insert_acc_bs_index-flat-5 =i -1 : Int
        map_insert_loc_keys-flat-7 =r map_insert_acc_keys-flat-3
        map_insert_size-flat-14 = Array_length#
                                    map_insert_loc_keys-flat-7
        bs_acc_found-flat-22 =i False : Bool
        bs_acc_mid-flat-19 =i -1 : Int
        bs_acc_ins-flat-21 =i -1 : Int
        bs_acc_low-flat-27 =i 0 : Int
        bs_acc_high-flat-28 =i sub#
                                 map_insert_size-flat-14
                                 1 : Int
        bs_acc_end-flat-29 =i False : Bool
        
        while (bs_acc_end-flat-29 == False)
        {
            bs_loc_low-flat-25 =r bs_acc_low-flat-27
            bs_loc_high-flat-26 =r bs_acc_high-flat-28
            
            if (gt#
                  bs_loc_low-flat-25
                  bs_loc_high-flat-26)
            {
                bs_acc_end-flat-29 =w True
                bs_acc_ins-flat-21 =w bs_loc_low-flat-25
            }
            else
            {
                simpflat-1 = add#
                               bs_loc_low-flat-25
                               bs_loc_high-flat-26
                simpflat-2 = doubleOfInt#
                               simpflat-1
                simpflat-3 = div# simpflat-2 2.0
                bs_acc_mid-flat-19 =w floor#
                                        simpflat-3
                bs_loc_mid-flat-23 =r bs_acc_mid-flat-19
                bs_loc_x-flat-24 = unsafe_Array_index#
                                     map_insert_loc_keys-flat-7
                                     bs_loc_mid-flat-23
                
                if (eq#
                      bs_loc_x-flat-24
                      conv-0-simpflat-136)
                {
                    bs_acc_end-flat-29 =w True
                    bs_acc_found-flat-22 =w True
                }
                else
                {
                    
                    if (lt#
                          bs_loc_x-flat-24
                          conv-0-simpflat-136)
                    {
                        bs_acc_low-flat-27 =w add#
                                                bs_loc_mid-flat-23
                                                1
                    }
                    else
                    {
                        bs_acc_high-flat-28 =w sub#
                                                 bs_loc_mid-flat-23
                                                 1
                    }
                    
                }
                
            }
            
        }
        
        bs_loc_found-flat-17 =r bs_acc_found-flat-22
        bs_loc_mid-flat-18 =r bs_acc_mid-flat-19
        bs_loc_ins-flat-20 =r bs_acc_ins-flat-21
        
        if (eq#
              bs_loc_found-flat-17
              True)
        {
            map_insert_acc_bs_found-flat-6 =w True
            map_insert_acc_bs_index-flat-5 =w bs_loc_mid-flat-18
        }
        else
        {
            map_insert_acc_bs_found-flat-6 =w False
            map_insert_acc_bs_index-flat-5 =w bs_loc_ins-flat-20
        }
        
        flat-105 =r map_insert_acc_bs_found-flat-6
        flat-106 =r map_insert_acc_bs_index-flat-5
        
        if (eq# flat-105 True)
        {
            copy_array-flat-34-simpflat-49 =r map_insert_acc_vals-flat-4-simpflat-43
            copy_array-flat-34-simpflat-50 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-4 = Array_length#
                           copy_array-flat-34-simpflat-49
            
            if (ne# simpflat-4 0)
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w copy_array-flat-34-simpflat-49
                map_insert_acc_vals-flat-4-simpflat-44 =w copy_array-flat-34-simpflat-50
            }
            
            map_insert_cpy_vals-flat-10-simpflat-52 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_cpy_vals-flat-10-simpflat-53 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-257 = unsafe_Array_index#
                             map_insert_cpy_vals-flat-10-simpflat-52
                             flat-106
            simpflat-259 = unsafe_Array_index#
                             map_insert_cpy_vals-flat-10-simpflat-53
                             flat-106
            simpflat-264 = Buf_push#
                             simpflat-257
                             conv-0-simpflat-134
            simpflat-267 = Buf_push#
                             simpflat-259
                             conv-0-simpflat-135
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-106
                                                        simpflat-264
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-106
                                                        simpflat-267
        }
        else
        {
            copy_array-flat-33 =r map_insert_acc_keys-flat-3
            simpflat-5 = Array_length#
                           copy_array-flat-33
            
            if (ne# simpflat-5 0)
            {
                map_insert_acc_keys-flat-3 =w copy_array-flat-33
            }
            
            flat-107-simpflat-58 =r map_insert_acc_vals-flat-4-simpflat-43
            flat-107-simpflat-59 =r map_insert_acc_vals-flat-4-simpflat-44
            simpflat-6 = Array_length#
                           flat-107-simpflat-58
            
            if (ne# simpflat-6 0)
            {
                map_insert_acc_vals-flat-4-simpflat-43 =w flat-107-simpflat-58
                map_insert_acc_vals-flat-4-simpflat-44 =w flat-107-simpflat-59
            }
            
            map_insert_cpy_keys-flat-9 =r map_insert_acc_keys-flat-3
            flat-108-simpflat-61 =r map_insert_acc_vals-flat-4-simpflat-43
            flat-108-simpflat-62 =r map_insert_acc_vals-flat-4-simpflat-44
            
            foreach (for_counter-flat-35 in map_insert_size-flat-14 .. flat-106)
            {
                update_acc-flat-36 =r map_insert_acc_keys-flat-3
                simpflat-7 = sub#
                               for_counter-flat-35
                               1
                simpflat-8 = unsafe_Array_index#
                               map_insert_cpy_keys-flat-9
                               simpflat-7
                map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                                update_acc-flat-36
                                                for_counter-flat-35
                                                simpflat-8
                update_acc-flat-37-simpflat-64 =r map_insert_acc_vals-flat-4-simpflat-43
                update_acc-flat-37-simpflat-65 =r map_insert_acc_vals-flat-4-simpflat-44
                simpflat-282 = unsafe_Array_index#
                                 flat-108-simpflat-61
                                 simpflat-7
                simpflat-284 = unsafe_Array_index#
                                 flat-108-simpflat-62
                                 simpflat-7
                map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                            update_acc-flat-37-simpflat-64
                                                            for_counter-flat-35
                                                            simpflat-282
                map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                            update_acc-flat-37-simpflat-65
                                                            for_counter-flat-35
                                                            simpflat-284
            }
            
            map_insert_acc_keys-flat-3 =r map_insert_acc_keys-flat-3
            map_insert_acc_keys-flat-3 =w Array_put_mutable#
                                            map_insert_acc_keys-flat-3
                                            flat-106
                                            conv-0-simpflat-136
            simpflat-359 = Buf_make# ()
            simpflat-294 = Buf_push#
                             simpflat-359
                             conv-0-simpflat-134
            simpflat-360 = Buf_make# ()
            simpflat-296 = Buf_push#
                             simpflat-360
                             conv-0-simpflat-135
            map_insert_acc_vals-flat-4-simpflat-43 =r map_insert_acc_vals-flat-4-simpflat-43
            map_insert_acc_vals-flat-4-simpflat-43 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-43
                                                        flat-106
                                                        simpflat-294
            map_insert_acc_vals-flat-4-simpflat-44 =r map_insert_acc_vals-flat-4-simpflat-44
            map_insert_acc_vals-flat-4-simpflat-44 =w Array_put_mutable#
                                                        map_insert_acc_vals-flat-4-simpflat-44
                                                        flat-106
                                                        simpflat-296
        }
        
        flat-109 =r map_insert_acc_keys-flat-3
        flat-110-simpflat-70 =r map_insert_acc_vals-flat-4-simpflat-43
        flat-110-simpflat-71 =r map_insert_acc_vals-flat-4-simpflat-44
        flat-41-simpflat-73 =i ExceptNotAnError : Error
        flat-41-simpflat-74 =i unsafe_Array_create#
                                 0 : Array Time
        flat-41-simpflat-75 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Error)
        flat-41-simpflat-76 =i unsafe_Array_create#
                                 0 : Array (Buf 2 Int)
        simpflat-12 = Array_length#
                        flat-109
        
        if (lt# simpflat-12 conv-3)
        {
            flat-41-simpflat-73 =w ExceptNotAnError
            flat-41-simpflat-74 =w flat-109
            flat-41-simpflat-75 =w flat-110-simpflat-70
            flat-41-simpflat-76 =w flat-110-simpflat-71
        }
        else
        {
            flat-41-simpflat-73 =w ExceptCannotCompute
            flat-41-simpflat-74 =w unsafe_Array_create#
                                     0
            flat-41-simpflat-75 =w unsafe_Array_create#
                                     0
            flat-41-simpflat-76 =w unsafe_Array_create#
                                     0
        }
        
        flat-41-simpflat-78 =r flat-41-simpflat-73
        flat-41-simpflat-79 =r flat-41-simpflat-74
        flat-41-simpflat-80 =r flat-41-simpflat-75
        flat-41-simpflat-81 =r flat-41-simpflat-76
        flat-0-simpflat-38 =w flat-41-simpflat-78
        flat-0-simpflat-39 =w flat-41-simpflat-79
        flat-0-simpflat-40 =w flat-41-simpflat-80
        flat-0-simpflat-41 =w flat-41-simpflat-81
    }
    else
    {
        flat-0-simpflat-38 =w conv-35-aval-0-simpflat-33
        flat-0-simpflat-39 =w unsafe_Array_create#
                                0
        flat-0-simpflat-40 =w unsafe_Array_create#
                                0
        flat-0-simpflat-41 =w unsafe_Array_create#
                                0
    }
    
    flat-0-simpflat-83 =r flat-0-simpflat-38
    flat-0-simpflat-84 =r flat-0-simpflat-39
    flat-0-simpflat-85 =r flat-0-simpflat-40
    flat-0-simpflat-86 =r flat-0-simpflat-41
    acc-conv-35-simpflat-28 =w flat-0-simpflat-83
    acc-conv-35-simpflat-29 =w flat-0-simpflat-84
    acc-conv-35-simpflat-30 =w flat-0-simpflat-85
    acc-conv-35-simpflat-31 =w flat-0-simpflat-86
}

conv-35-simpflat-88 =r acc-conv-35-simpflat-28
conv-35-simpflat-89 =r acc-conv-35-simpflat-29
conv-35-simpflat-90 =r acc-conv-35-simpflat-30
conv-35-simpflat-91 =r acc-conv-35-simpflat-31
flat-42-simpflat-93 =i ExceptNotAnError : Error
flat-42-simpflat-94 =i unsafe_Array_create#
                         0 : Array Time
flat-42-simpflat-95 =i unsafe_Array_create#
                         0 : Array Int

if (eq#
      conv-35-simpflat-88
      ExceptNotAnError)
{
    flat-50-simpflat-96 =i ExceptNotAnError : Error
    flat-50-simpflat-97 =i unsafe_Array_create#
                             0 : Array Time
    flat-50-simpflat-98 =i unsafe_Array_create#
                             0 : Array Int
    
    foreach (for_counter-flat-51 in 0 .. Array_length#
                                           conv-35-simpflat-89)
    {
        flat-50-simpflat-99 =r flat-50-simpflat-96
        flat-50-simpflat-100 =r flat-50-simpflat-97
        flat-50-simpflat-101 =r flat-50-simpflat-98
        simpflat-318 = unsafe_Array_index#
                         conv-35-simpflat-89
                         for_counter-flat-51
        simpflat-320 = unsafe_Array_index#
                         conv-35-simpflat-90
                         for_counter-flat-51
        simpflat-322 = unsafe_Array_index#
                         conv-35-simpflat-91
                         for_counter-flat-51
        flat-53-simpflat-102 =i ExceptNotAnError : Error
        flat-53-simpflat-103 =i unsafe_Array_create#
                                  0 : Array Time
        flat-53-simpflat-104 =i unsafe_Array_create#
                                  0 : Array Int
        
        if (eq#
              flat-50-simpflat-99
              ExceptNotAnError)
        {
            simpflat-334 = Buf_read#
                             simpflat-320
            simpflat-336 = Buf_read#
                             simpflat-322
            flat-57-simpflat-105 =i ExceptNotAnError : Error
            flat-57-simpflat-106 =i 0 : Int
            
            foreach (for_counter-flat-97 in 0 .. Array_length#
                                                   simpflat-334)
            {
                flat-57-simpflat-107 =r flat-57-simpflat-105
                flat-57-simpflat-108 =r flat-57-simpflat-106
                simpflat-341 = unsafe_Array_index#
                                 simpflat-334
                                 for_counter-flat-97
                simpflat-343 = unsafe_Array_index#
                                 simpflat-336
                                 for_counter-flat-97
                flat-99-simpflat-109 =i ExceptNotAnError : Error
                flat-99-simpflat-110 =i 0 : Int
                
                if (eq#
                      simpflat-341
                      ExceptNotAnError)
                {
                    flat-102-simpflat-111 =i ExceptNotAnError : Error
                    flat-102-simpflat-112 =i 0 : Int
                    
                    if (eq#
                          flat-57-simpflat-107
                          ExceptNotAnError)
                    {
                        simpflat-15 = add#
                                        simpflat-343
                                        flat-57-simpflat-108
                        flat-102-simpflat-111 =w ExceptNotAnError
                        flat-102-simpflat-112 =w simpflat-15
                    }
                    else
                    {
                        flat-102-simpflat-111 =w flat-57-simpflat-107
                        flat-102-simpflat-112 =w 0
                    }
                    
                    flat-102-simpflat-113 =r flat-102-simpflat-111
                    flat-102-simpflat-114 =r flat-102-simpflat-112
                    flat-99-simpflat-109 =w flat-102-simpflat-113
                    flat-99-simpflat-110 =w flat-102-simpflat-114
                }
                else
                {
                    flat-99-simpflat-109 =w simpflat-341
                    flat-99-simpflat-110 =w 0
                }
                
                flat-99-simpflat-115 =r flat-99-simpflat-109
                flat-99-simpflat-116 =r flat-99-simpflat-110
                flat-57-simpflat-105 =w flat-99-simpflat-115
                flat-57-simpflat-106 =w flat-99-simpflat-116
            }
            
            flat-112-simpflat-117 =r flat-57-simpflat-105
            flat-112-simpflat-118 =r flat-57-simpflat-106
            flat-58-simpflat-119 =i ExceptNotAnError : Error
            flat-58-simpflat-120 =i unsafe_Array_create#
                                      0 : Array Time
            flat-58-simpflat-121 =i unsafe_Array_create#
                                      0 : Array Int
            
            if (eq#
                  flat-112-simpflat-117
                  ExceptNotAnError)
            {
                map_insert_acc_keys-flat-61 =i flat-50-simpflat-100 : Array Time
                map_insert_acc_vals-flat-62 =i flat-50-simpflat-101 : Array Int
                map_insert_acc_bs_found-flat-64 =i False : Bool
                map_insert_acc_bs_index-flat-63 =i -1 : Int
                map_insert_loc_keys-flat-65 =r map_insert_acc_keys-flat-61
                map_insert_size-flat-72 = Array_length#
                                            map_insert_loc_keys-flat-65
                bs_acc_found-flat-80 =i False : Bool
                bs_acc_mid-flat-77 =i -1 : Int
                bs_acc_ins-flat-79 =i -1 : Int
                bs_acc_low-flat-85 =i 0 : Int
                bs_acc_high-flat-86 =i sub#
                                         map_insert_size-flat-72
                                         1 : Int
                bs_acc_end-flat-87 =i False : Bool
                
                while (bs_acc_end-flat-87 == False)
                {
                    bs_loc_low-flat-83 =r bs_acc_low-flat-85
                    bs_loc_high-flat-84 =r bs_acc_high-flat-86
                    
                    if (gt#
                          bs_loc_low-flat-83
                          bs_loc_high-flat-84)
                    {
                        bs_acc_end-flat-87 =w True
                        bs_acc_ins-flat-79 =w bs_loc_low-flat-83
                    }
                    else
                    {
                        simpflat-18 = add#
                                        bs_loc_low-flat-83
                                        bs_loc_high-flat-84
                        simpflat-19 = doubleOfInt#
                                        simpflat-18
                        simpflat-20 = div#
                                        simpflat-19
                                        2.0
                        bs_acc_mid-flat-77 =w floor#
                                                simpflat-20
                        bs_loc_mid-flat-81 =r bs_acc_mid-flat-77
                        bs_loc_x-flat-82 = unsafe_Array_index#
                                             map_insert_loc_keys-flat-65
                                             bs_loc_mid-flat-81
                        
                        if (eq#
                              bs_loc_x-flat-82
                              simpflat-318)
                        {
                            bs_acc_end-flat-87 =w True
                            bs_acc_found-flat-80 =w True
                        }
                        else
                        {
                            
                            if (lt#
                                  bs_loc_x-flat-82
                                  simpflat-318)
                            {
                                bs_acc_low-flat-85 =w add#
                                                        bs_loc_mid-flat-81
                                                        1
                            }
                            else
                            {
                                bs_acc_high-flat-86 =w sub#
                                                         bs_loc_mid-flat-81
                                                         1
                            }
                            
                        }
                        
                    }
                    
                }
                
                bs_loc_found-flat-75 =r bs_acc_found-flat-80
                bs_loc_mid-flat-76 =r bs_acc_mid-flat-77
                bs_loc_ins-flat-78 =r bs_acc_ins-flat-79
                
                if (eq#
                      bs_loc_found-flat-75
                      True)
                {
                    map_insert_acc_bs_found-flat-64 =w True
                    map_insert_acc_bs_index-flat-63 =w bs_loc_mid-flat-76
                }
                else
                {
                    map_insert_acc_bs_found-flat-64 =w False
                    map_insert_acc_bs_index-flat-63 =w bs_loc_ins-flat-78
                }
                
                flat-113 =r map_insert_acc_bs_found-flat-64
                flat-114 =r map_insert_acc_bs_index-flat-63
                
                if (eq# flat-113 True)
                {
                    copy_array-flat-91 =r map_insert_acc_vals-flat-62
                    simpflat-21 = Array_length#
                                    copy_array-flat-91
                    
                    if (ne# simpflat-21 0)
                    {
                        map_insert_acc_vals-flat-62 =w copy_array-flat-91
                    }
                    
                    map_insert_acc_vals-flat-62 =r map_insert_acc_vals-flat-62
                    map_insert_acc_vals-flat-62 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-62
                                                     flat-114
                                                     flat-112-simpflat-118
                }
                else
                {
                    copy_array-flat-90 =r map_insert_acc_keys-flat-61
                    simpflat-22 = Array_length#
                                    copy_array-flat-90
                    
                    if (ne# simpflat-22 0)
                    {
                        map_insert_acc_keys-flat-61 =w copy_array-flat-90
                    }
                    
                    flat-115 =r map_insert_acc_vals-flat-62
                    simpflat-23 = Array_length#
                                    flat-115
                    
                    if (ne# simpflat-23 0)
                    {
                        map_insert_acc_vals-flat-62 =w flat-115
                    }
                    
                    map_insert_cpy_keys-flat-67 =r map_insert_acc_keys-flat-61
                    flat-116 =r map_insert_acc_vals-flat-62
                    
                    foreach (for_counter-flat-92 in map_insert_size-flat-72 .. flat-114)
                    {
                        update_acc-flat-93 =r map_insert_acc_keys-flat-61
                        simpflat-24 = sub#
                                        for_counter-flat-92
                                        1
                        simpflat-25 = unsafe_Array_index#
                                        map_insert_cpy_keys-flat-67
                                        simpflat-24
                        map_insert_acc_keys-flat-61 =w Array_put_mutable#
                                                         update_acc-flat-93
                                                         for_counter-flat-92
                                                         simpflat-25
                        update_acc-flat-94 =r map_insert_acc_vals-flat-62
                        simpflat-27 = unsafe_Array_index#
                                        flat-116
                                        simpflat-24
                        map_insert_acc_vals-flat-62 =w Array_put_mutable#
                                                         update_acc-flat-94
                                                         for_counter-flat-92
                                                         simpflat-27
                    }
                    
                    map_insert_acc_keys-flat-61 =r map_insert_acc_keys-flat-61
                    map_insert_acc_keys-flat-61 =w Array_put_mutable#
                                                     map_insert_acc_keys-flat-61
                                                     flat-114
                                                     simpflat-318
                    map_insert_acc_vals-flat-62 =r map_insert_acc_vals-flat-62
                    map_insert_acc_vals-flat-62 =w Array_put_mutable#
                                                     map_insert_acc_vals-flat-62
                                                     flat-114
                                                     flat-112-simpflat-118
                }
                
                flat-117 =r map_insert_acc_keys-flat-61
                flat-118 =r map_insert_acc_vals-flat-62
                flat-58-simpflat-119 =w ExceptNotAnError
                flat-58-simpflat-120 =w flat-117
                flat-58-simpflat-121 =w flat-118
            }
            else
            {
                flat-58-simpflat-119 =w flat-112-simpflat-117
                flat-58-simpflat-120 =w unsafe_Array_create#
                                          0
                flat-58-simpflat-121 =w unsafe_Array_create#
                                          0
            }
            
            flat-58-simpflat-122 =r flat-58-simpflat-119
            flat-58-simpflat-123 =r flat-58-simpflat-120
            flat-58-simpflat-124 =r flat-58-simpflat-121
            flat-53-simpflat-102 =w flat-58-simpflat-122
            flat-53-simpflat-103 =w flat-58-simpflat-123
            flat-53-simpflat-104 =w flat-58-simpflat-124
        }
        else
        {
            flat-53-simpflat-102 =w flat-50-simpflat-99
            flat-53-simpflat-103 =w unsafe_Array_create#
                                      0
            flat-53-simpflat-104 =w unsafe_Array_create#
                                      0
        }
        
        flat-53-simpflat-125 =r flat-53-simpflat-102
        flat-53-simpflat-126 =r flat-53-simpflat-103
        flat-53-simpflat-127 =r flat-53-simpflat-104
        flat-50-simpflat-96 =w flat-53-simpflat-125
        flat-50-simpflat-97 =w flat-53-simpflat-126
        flat-50-simpflat-98 =w flat-53-simpflat-127
    }
    
    flat-119-simpflat-128 =r flat-50-simpflat-96
    flat-119-simpflat-129 =r flat-50-simpflat-97
    flat-119-simpflat-130 =r flat-50-simpflat-98
    flat-42-simpflat-93 =w flat-119-simpflat-128
    flat-42-simpflat-94 =w flat-119-simpflat-129
    flat-42-simpflat-95 =w flat-119-simpflat-130
}
else
{
    flat-42-simpflat-93 =w conv-35-simpflat-88
    flat-42-simpflat-94 =w unsafe_Array_create#
                             0
    flat-42-simpflat-95 =w unsafe_Array_create#
                             0
}

flat-42-simpflat-131 =r flat-42-simpflat-93
flat-42-simpflat-132 =r flat-42-simpflat-94
flat-42-simpflat-133 =r flat-42-simpflat-95

output repl:output : Sum Error (Map Time Int) =
    flat-42-simpflat-131 : Error
  , flat-42-simpflat-132 : Array Time
  , flat-42-simpflat-133 : Array Int

Core evaluation
---------------

homer|[ (1989-12-17, 100)
      , (1990-01-01, 200)
      , (1994-01-01, 300)
      , (1999-01-01, 400)
      , (2010-01-01, 500)
      ]
marge|[ (1989-12-17, 30) ]

λ λ λ 